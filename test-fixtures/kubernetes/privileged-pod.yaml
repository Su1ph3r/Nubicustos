# Intentionally Vulnerable Kubernetes Pod
# For testing Nubicustos K8s scanners (kube-bench, Kubescape, kube-linter, Polaris)

apiVersion: v1
kind: Pod
metadata:
  name: privileged-pod
  namespace: default
  labels:
    app: vulnerable-app
spec:
  # VULN: hostNetwork allows access to host network namespace
  hostNetwork: true
  # VULN: hostPID allows access to host process namespace
  hostPID: true
  # VULN: hostIPC allows access to host IPC namespace
  hostIPC: true

  containers:
  - name: privileged-container
    # VULN: Using :latest tag - no version pinning
    image: nginx:latest

    # VULN: No resource limits defined
    # Missing: resources.limits.cpu, resources.limits.memory

    securityContext:
      # VULN: Running as privileged container
      privileged: true
      # VULN: Running as root
      runAsUser: 0
      runAsGroup: 0
      # VULN: Writable root filesystem
      readOnlyRootFilesystem: false
      # VULN: Can escalate privileges
      allowPrivilegeEscalation: true
      # VULN: All capabilities added
      capabilities:
        add:
        - ALL
        - SYS_ADMIN
        - NET_ADMIN
        - SYS_PTRACE
        - SYS_RAWIO

    ports:
    - containerPort: 80
      hostPort: 80  # VULN: Using hostPort

    volumeMounts:
    # VULN: Mounting host filesystem
    - name: host-root
      mountPath: /host
    # VULN: Mounting Docker socket
    - name: docker-socket
      mountPath: /var/run/docker.sock
    # VULN: Mounting sensitive paths
    - name: host-etc
      mountPath: /host-etc

  volumes:
  # VULN: Host path mount - root filesystem
  - name: host-root
    hostPath:
      path: /
      type: Directory
  # VULN: Docker socket mount
  - name: docker-socket
    hostPath:
      path: /var/run/docker.sock
      type: Socket
  # VULN: Sensitive host path
  - name: host-etc
    hostPath:
      path: /etc
      type: Directory
