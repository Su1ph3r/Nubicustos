# Intentionally Vulnerable Kubernetes Service & Ingress
# For testing Nubicustos K8s scanners

apiVersion: v1
kind: Service
metadata:
  name: insecure-service
  namespace: default
spec:
  # VULN: LoadBalancer exposed to internet with no network policy
  type: LoadBalancer
  # VULN: External traffic policy allows source IP spoofing
  externalTrafficPolicy: Cluster
  selector:
    app: insecure-app
  ports:
  - name: http
    port: 80
    targetPort: 8080
  - name: debug
    # VULN: Debug port exposed
    port: 9090
    targetPort: 9090

---
apiVersion: v1
kind: Service
metadata:
  name: nodeport-service
  namespace: default
spec:
  # VULN: NodePort exposes service on all nodes
  type: NodePort
  selector:
    app: insecure-app
  ports:
  - port: 80
    targetPort: 8080
    # VULN: High nodePort in privileged range
    nodePort: 30080

---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: insecure-ingress
  namespace: default
  annotations:
    # VULN: No rate limiting
    # VULN: No WAF rules
    kubernetes.io/ingress.class: nginx
spec:
  # VULN: No TLS configured - traffic is unencrypted
  rules:
  - host: insecure-app.example.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: insecure-service
            port:
              number: 80
  # VULN: Wildcard host allows all traffic
  - http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: insecure-service
            port:
              number: 80
