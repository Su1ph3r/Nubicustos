import{d as A,r as d,c as _}from"./index-CGJ-odjO.js";const w="/api";class h extends Error{constructor(t,n,i){super(t),this.status=n,this.data=i}}async function v(e,t={}){const n=`${w}${e}`,i={headers:{"Content-Type":"application/json",...t.headers},...t};try{const o=await fetch(n,i);if(!o.ok){const c=await o.json().catch(()=>({}));throw new h(c.detail||`HTTP error ${o.status}`,o.status,c)}const f=await o.text();return f?JSON.parse(f):null}catch(o){throw o instanceof h?o:new h(o.message,0,null)}}const p={async getFindings(e={}){const t=new URLSearchParams;e.page&&t.set("page",e.page),e.page_size&&t.set("page_size",e.page_size),e.severity&&t.set("severity",e.severity),e.status&&t.set("status",e.status),e.tool&&t.set("tool",e.tool),e.cloud_provider&&t.set("cloud_provider",e.cloud_provider),e.resource_type&&t.set("resource_type",e.resource_type),e.search&&t.set("search",e.search);const n=t.toString();return v(`/findings${n?`?${n}`:""}`)},async getFinding(e){return v(`/findings/${e}`)},async getSummary(){return v("/findings/summary")},async updateFinding(e,t){return v(`/findings/${e}`,{method:"PATCH",body:JSON.stringify(t)})},async getScans(e={}){const t=new URLSearchParams;e.page&&t.set("page",e.page),e.page_size&&t.set("page_size",e.page_size),e.status&&t.set("status",e.status),e.tool&&t.set("tool",e.tool);const n=t.toString();return v(`/scans${n?`?${n}`:""}`)},async getScan(e){return v(`/scans/${e}`)},getExportUrl(e,t={}){const n=new URLSearchParams;t.severity&&n.set("severity",t.severity),t.status&&n.set("status",t.status),t.tool&&n.set("tool",t.tool),t.include_remediation&&n.set("include_remediation","true");const i=n.toString();return`${w}/exports/${e}${i?`?${i}`:""}`},async getHealth(){return v("/health")},async getDetailedHealth(){return v("/health/detailed")}},U=A("findings",()=>{const e=d([]),t=d(null),n=d(0),i=d(1),o=d(50),f=d(!1),c=d(null),g=d({severity:null,status:null,tool:null,cloud_provider:null,resource_type:null,search:""}),y=d({severities:["critical","high","medium","low","info"],statuses:["open","closed","mitigated","accepted"],tools:[],cloudProviders:[],resourceTypes:[]}),S=_(()=>Object.values(g.value).some(s=>s!==null&&s!=="")),F=_(()=>Math.ceil(n.value/o.value));async function P(){f.value=!0,c.value=null;try{const s={page:i.value,page_size:o.value,...g.value};Object.keys(s).forEach(u=>{(s[u]===null||s[u]==="")&&delete s[u]});const r=await p.getFindings(s);e.value=r.findings||[],n.value=r.total||0,x(e.value)}catch(s){c.value=s.message,e.value=[],n.value=0}finally{f.value=!1}}async function $(s){f.value=!0,c.value=null;try{t.value=await p.getFinding(s)}catch(r){c.value=r.message,t.value=null}finally{f.value=!1}}async function z(s,r){var u;try{const l=await p.updateFinding(s,r),a=e.value.findIndex(q=>q.id===s);return a!==-1&&(e.value[a]={...e.value[a],...l}),((u=t.value)==null?void 0:u.id)===s&&(t.value={...t.value,...l}),l}catch(l){throw c.value=l.message,l}}function x(s){const r=new Set,u=new Set,l=new Set;s.forEach(a=>{a.tool&&r.add(a.tool),a.cloud_provider&&u.add(a.cloud_provider),a.resource_type&&l.add(a.resource_type)}),r.size>0&&(y.value.tools=[...r].sort()),u.size>0&&(y.value.cloudProviders=[...u].sort()),l.size>0&&(y.value.resourceTypes=[...l].sort())}function T(s,r){g.value[s]=r,i.value=1}function E(){g.value={severity:null,status:null,tool:null,cloud_provider:null,resource_type:null,search:""},i.value=1}function O(s){i.value=s}function j(s){o.value=s,i.value=1}return{findings:e,currentFinding:t,total:n,page:i,pageSize:o,loading:f,error:c,filters:g,filterOptions:y,hasFilters:S,totalPages:F,fetchFindings:P,fetchFinding:$,updateFinding:z,setFilter:T,clearFilters:E,setPage:O,setPageSize:j}});export{p as a,U as u};
