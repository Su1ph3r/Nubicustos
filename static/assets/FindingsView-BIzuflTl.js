import{_ as D,r as x,c as V,w as O,a as F,o as w,e as t,x as o,y as S,q as E,f as P,A as b,t as p,n as N,B as k,j as H,C as G,u as m}from"./index-CGJ-odjO.js";import{u as A}from"./findings-DQFdRCg-.js";import{F as K}from"./FindingDetail-B0bK2l9O.js";const J={class:"filters-container"},Q={class:"filters-row"},W={class:"filter-group"},X={class:"filter-group"},Y={class:"filter-group"},Z={class:"filter-group"},ee={class:"filter-group"},te={class:"filter-actions"},le={__name:"FindingFilters",emits:["filter-change"],setup(u,{emit:C}){const e=C,l=A(),c=x(l.filters.search||""),g=x(l.filters.severity?[l.filters.severity]:[]),y=x(l.filters.status?[l.filters.status]:[]),a=x(l.filters.tool||null),s=x(l.filters.cloud_provider||null);let v=null;const $=[{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"},{label:"Info",value:"info"}],r=[{label:"Open",value:"open"},{label:"Closed",value:"closed"},{label:"Mitigated",value:"mitigated"},{label:"Accepted",value:"accepted"}],f=V(()=>l.filterOptions.tools.map(d=>({label:d,value:d}))),T=V(()=>l.filterOptions.cloudProviders.map(d=>({label:d,value:d}))),h=V(()=>l.hasFilters),z=()=>{clearTimeout(v),v=setTimeout(()=>{l.setFilter("search",c.value),e("filter-change")},300)},R=()=>{const d=g.value.length>0?g.value.join(","):null;l.setFilter("severity",d),e("filter-change")},i=()=>{const d=y.value.length>0?y.value.join(","):null;l.setFilter("status",d),e("filter-change")},L=()=>{l.setFilter("tool",a.value),e("filter-change")},U=()=>{l.setFilter("cloud_provider",s.value),e("filter-change")},q=()=>{c.value="",g.value=[],y.value=[],a.value=null,s.value=null,l.clearFilters(),e("filter-change")};return O(()=>l.filters,d=>{d.search!==c.value&&(c.value=d.search||""),d.severity&&(g.value=d.severity.split(","))},{deep:!0}),(d,n)=>{const M=S("InputText"),B=S("MultiSelect"),I=S("Dropdown"),j=S("Button");return w(),F("div",J,[t("div",Q,[t("div",W,[n[5]||(n[5]=t("label",null,"Search",-1)),o(M,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=_=>c.value=_),placeholder:"Search findings...",onInput:z},null,8,["modelValue"])]),t("div",X,[n[6]||(n[6]=t("label",null,"Severity",-1)),o(B,{modelValue:g.value,"onUpdate:modelValue":n[1]||(n[1]=_=>g.value=_),options:$,optionLabel:"label",optionValue:"value",placeholder:"All Severities",display:"chip",onChange:R},null,8,["modelValue"])]),t("div",Y,[n[7]||(n[7]=t("label",null,"Status",-1)),o(B,{modelValue:y.value,"onUpdate:modelValue":n[2]||(n[2]=_=>y.value=_),options:r,optionLabel:"label",optionValue:"value",placeholder:"All Statuses",display:"chip",onChange:i},null,8,["modelValue"])]),t("div",Z,[n[8]||(n[8]=t("label",null,"Tool",-1)),o(I,{modelValue:a.value,"onUpdate:modelValue":n[3]||(n[3]=_=>a.value=_),options:f.value,optionLabel:"label",optionValue:"value",placeholder:"All Tools",showClear:"",onChange:L},null,8,["modelValue","options"])]),t("div",ee,[n[9]||(n[9]=t("label",null,"Provider",-1)),o(I,{modelValue:s.value,"onUpdate:modelValue":n[4]||(n[4]=_=>s.value=_),options:T.value,optionLabel:"label",optionValue:"value",placeholder:"All Providers",showClear:"",onChange:U},null,8,["modelValue","options"])]),t("div",te,[h.value?(w(),E(j,{key:0,label:"Clear",icon:"pi pi-times",severity:"secondary",size:"small",onClick:q})):P("",!0)])])])}}},se=D(le,[["__scopeId","data-v-d37839f5"]]),oe={class:"findings-table-container"},ae={class:"empty-state"},ne={key:0},ie={class:"loading-state"},re={class:"tool-badge"},de={class:"finding-title-cell"},ue={class:"title"},ce={key:0,class:"resource-name"},pe={class:"pagination-container"},ge={class:"pagination-info"},ve={__name:"FindingsTable",props:{findings:{type:Array,default:()=>[]},total:{type:Number,default:0},page:{type:Number,default:1},pageSize:{type:Number,default:50},loading:{type:Boolean,default:!1},hasFilters:{type:Boolean,default:!1}},emits:["page-change","sort-change"],setup(u,{emit:C}){const e=u,l=C,c=x([]),g=V(()=>e.total===0?0:(e.page-1)*e.pageSize+1),y=V(()=>{const r=e.page*e.pageSize;return r>e.total?e.total:r}),a=r=>r?new Date(r).toLocaleDateString():"N/A",s=r=>{l("page-change",{page:r.page+1,pageSize:r.rows})},v=r=>{l("page-change",{page:r.page+1,pageSize:r.rows})},$=r=>{l("sort-change",{field:r.sortField,order:r.sortOrder})};return(r,f)=>{const T=S("ProgressSpinner"),h=S("Column"),z=S("DataTable"),R=S("Paginator");return w(),F("div",oe,[o(z,{value:u.findings,loading:u.loading,rows:u.pageSize,totalRecords:u.total,lazy:!0,expandedRows:c.value,"onUpdate:expandedRows":f[0]||(f[0]=i=>c.value=i),dataKey:"id",onPage:s,onSort:$,scrollable:"",scrollHeight:"flex",stripedRows:"",showGridlines:"",class:"findings-table"},{empty:b(()=>[t("div",ae,[f[1]||(f[1]=t("i",{class:"pi pi-inbox"},null,-1)),f[2]||(f[2]=t("p",null,"No findings found",-1)),u.hasFilters?(w(),F("span",ne,"Try adjusting your filters")):P("",!0)])]),loading:b(()=>[t("div",ie,[o(T),f[3]||(f[3]=t("span",null,"Loading findings...",-1))])]),expansion:b(({data:i})=>[o(K,{finding:i},null,8,["finding"])]),default:b(()=>[o(h,{expander:"",style:{width:"3rem"}}),o(h,{field:"severity",header:"Severity",sortable:!0,style:{width:"100px"}},{body:b(({data:i})=>[t("span",{class:N(["severity-badge",i.severity])},p(i.severity),3)]),_:1}),o(h,{field:"tool",header:"Tool",sortable:!0,style:{width:"120px"}},{body:b(({data:i})=>[t("span",re,p(i.tool),1)]),_:1}),o(h,{field:"title",header:"Finding",sortable:!0,style:{"min-width":"300px"}},{body:b(({data:i})=>[t("div",de,[t("span",ue,p(i.title),1),i.resource_name?(w(),F("span",ce,p(i.resource_name),1)):P("",!0)])]),_:1}),o(h,{field:"resource_type",header:"Resource Type",sortable:!0,style:{width:"150px"}}),o(h,{field:"region",header:"Region",sortable:!0,style:{width:"120px"}}),o(h,{field:"status",header:"Status",sortable:!0,style:{width:"100px"}},{body:b(({data:i})=>[t("span",{class:N(["status-badge",i.status])},p(i.status),3)]),_:1}),o(h,{field:"scan_date",header:"Date",sortable:!0,style:{width:"150px"}},{body:b(({data:i})=>[k(p(a(i.scan_date)),1)]),_:1})]),_:1},8,["value","loading","rows","totalRecords","expandedRows"]),t("div",pe,[t("div",ge," Showing "+p(g.value)+" to "+p(y.value)+" of "+p(u.total)+" findings ",1),o(R,{rows:u.pageSize,totalRecords:u.total,first:(u.page-1)*u.pageSize,rowsPerPageOptions:[25,50,100],onPage:v},null,8,["rows","totalRecords","first"])])])}}},fe=D(ve,[["__scopeId","data-v-8875844c"]]),he={class:"findings-view"},me={class:"findings-header"},ye={class:"header-content"},_e={class:"subtitle"},be={key:0},Se={class:"header-actions"},we={key:0,class:"error-message"},Ce={__name:"FindingsView",setup(u){const C=G(),e=A(),l=()=>{e.fetchFindings()},c=()=>{l()},g=({page:a,pageSize:s})=>{s!==e.pageSize&&e.setPageSize(s),a!==e.page&&e.setPage(a),l()},y=()=>{const a=new URLSearchParams,s=e.filters;s.severity&&a.set("severity",s.severity),s.status&&a.set("status",s.status),s.tool&&a.set("tool",s.tool),s.cloud_provider&&a.set("cloud_provider",s.cloud_provider),a.set("include_remediation","true");const v=a.toString();window.open(`/api/exports/csv${v?`?${v}`:""}`,"_blank")};return H(()=>{C.query.severity&&e.setFilter("severity",C.query.severity),l()}),O(()=>C.query,a=>{a.severity&&(e.setFilter("severity",a.severity),l())}),(a,s)=>{const v=S("Button");return w(),F("div",he,[t("div",me,[t("div",ye,[s[0]||(s[0]=t("h2",null,"Security Findings",-1)),t("p",_e,[k(p(m(e).total)+" findings ",1),m(e).hasFilters?(w(),F("span",be,"(filtered)")):P("",!0)])]),t("div",Se,[o(v,{label:"Export CSV",icon:"pi pi-download",severity:"secondary",onClick:y})])]),o(se,{onFilterChange:c}),m(e).error?(w(),F("div",we,[s[1]||(s[1]=t("i",{class:"pi pi-exclamation-triangle"},null,-1)),k(" "+p(m(e).error)+" ",1),o(v,{label:"Retry",size:"small",onClick:l})])):P("",!0),o(fe,{findings:m(e).findings,total:m(e).total,page:m(e).page,"page-size":m(e).pageSize,loading:m(e).loading,"has-filters":m(e).hasFilters,onPageChange:g},null,8,["findings","total","page","page-size","loading","has-filters"])])}}},Pe=D(Ce,[["__scopeId","data-v-511d1701"]]);export{Pe as default};
