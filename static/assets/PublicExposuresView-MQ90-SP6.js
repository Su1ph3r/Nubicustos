import{d as I,r as v,c as $,_ as R,j as z,a as L,e as t,f as S,x as i,q as T,u as e,t as _,H as V,I as F,A as k,J as A,K as j,o as w,L as f,M as B,n as N}from"./index-D2tkqljB.js";const E="/api",H=I("publicExposures",()=>{const h=v([]),a=v(null),n=v(null),m=v(!1),p=v(null),d=v({page:1,pageSize:50,total:0}),r=v({exposureType:null,riskLevel:null,cloudProvider:null,isInternetExposed:null,status:"open"}),g=$(()=>h.value.filter(s=>s.risk_level==="critical")),b=$(()=>h.value.filter(s=>s.is_internet_exposed).length);async function y(){m.value=!0,p.value=null;try{const s=new URLSearchParams;s.append("page",d.value.page),s.append("page_size",d.value.pageSize),r.value.exposureType&&s.append("exposure_type",r.value.exposureType),r.value.riskLevel&&s.append("risk_level",r.value.riskLevel),r.value.cloudProvider&&s.append("cloud_provider",r.value.cloudProvider),r.value.isInternetExposed!==null&&s.append("is_internet_exposed",r.value.isInternetExposed),r.value.status&&s.append("status",r.value.status);const c=await fetch(`${E}/public-exposures?${s}`);if(!c.ok)throw new Error("Failed to fetch public exposures");const x=await c.json();h.value=x.exposures,d.value.total=x.total}catch(s){p.value=s.message,console.error("Error fetching public exposures:",s)}finally{m.value=!1}}async function P(s){m.value=!0,p.value=null;try{const c=await fetch(`${E}/public-exposures/${s}`);if(!c.ok)throw new Error("Failed to fetch exposure");return a.value=await c.json(),a.value}catch(c){return p.value=c.message,null}finally{m.value=!1}}async function u(){try{const s=await fetch(`${E}/public-exposures/summary`);if(!s.ok)throw new Error("Failed to fetch summary");return n.value=await s.json(),n.value}catch(s){return console.error("Error fetching summary:",s),null}}async function l(s,c){try{if(!(await fetch(`${E}/public-exposures/${s}/status?status=${c}`,{method:"PATCH"})).ok)throw new Error("Failed to update status");return await y(),!0}catch(x){throw p.value=x.message,x}}function o(s){r.value={...r.value,...s},d.value.page=1,y()}function C(){r.value={exposureType:null,riskLevel:null,cloudProvider:null,isInternetExposed:null,status:"open"},d.value.page=1,y()}return{exposures:h,currentExposure:a,summary:n,loading:m,error:p,pagination:d,filters:r,criticalExposures:g,internetExposedCount:b,fetchExposures:y,fetchExposure:P,fetchSummary:u,updateStatus:l,setFilters:o,clearFilters:C}}),M={class:"public-exposures-view"},U={key:0,class:"summary-cards"},q={class:"summary-card critical"},D={class:"card-value"},J={class:"summary-card high"},K={class:"card-value"},O={class:"summary-card medium"},G={class:"card-value"},Q={class:"summary-card info"},W={class:"card-value"},X={class:"filters-section"},Y={__name:"PublicExposuresView",setup(h){const a=H(),n=v({exposureType:null,riskLevel:null}),m=["s3_bucket","security_group","elb","rds","api_gateway"],p=["critical","high","medium","low"],d=$(()=>Object.values(n.value).some(u=>u!==null));function r(u){return{critical:"danger",high:"warning",medium:"info",low:"success"}[u]||"secondary"}function g(){a.setFilters(n.value)}function b(){n.value={exposureType:null,riskLevel:null},a.clearFilters()}function y(u){console.log("View exposure:",u)}function P(u){a.pagination.page=u.page+1,a.fetchExposures()}return z(()=>{a.fetchExposures(),a.fetchSummary()}),(u,l)=>(w(),L("div",M,[l[6]||(l[6]=t("div",{class:"page-header"},[t("div",{class:"header-content"},[t("h1",null,"Public Exposures"),t("p",{class:"subtitle"},"Internet-exposed resources across cloud environments")])],-1)),e(a).summary?(w(),L("div",U,[t("div",q,[t("div",D,_(e(a).summary.critical),1),l[2]||(l[2]=t("div",{class:"card-label"},"Critical",-1))]),t("div",J,[t("div",K,_(e(a).summary.high),1),l[3]||(l[3]=t("div",{class:"card-label"},"High",-1))]),t("div",O,[t("div",G,_(e(a).summary.medium),1),l[4]||(l[4]=t("div",{class:"card-label"},"Medium",-1))]),t("div",Q,[t("div",W,_(e(a).summary.internet_exposed),1),l[5]||(l[5]=t("div",{class:"card-label"},"Internet Exposed",-1))])])):S("",!0),t("div",X,[i(e(V),{modelValue:n.value.exposureType,"onUpdate:modelValue":l[0]||(l[0]=o=>n.value.exposureType=o),options:m,placeholder:"Exposure Type",onChange:g,class:"filter-dropdown"},null,8,["modelValue"]),i(e(V),{modelValue:n.value.riskLevel,"onUpdate:modelValue":l[1]||(l[1]=o=>n.value.riskLevel=o),options:p,placeholder:"Risk Level",onChange:g,class:"filter-dropdown"},null,8,["modelValue"]),d.value?(w(),T(e(F),{key:0,label:"Clear",icon:"pi pi-times",severity:"secondary",text:"",onClick:b})):S("",!0)]),i(e(A),{value:e(a).exposures,loading:e(a).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:k(()=>[i(e(f),{field:"resource_type",header:"Resource Type"}),i(e(f),{field:"resource_name",header:"Resource Name"}),i(e(f),{field:"exposure_type",header:"Exposure Type"}),i(e(f),{field:"cloud_provider",header:"Provider"}),i(e(f),{field:"risk_level",header:"Risk"},{body:k(({data:o})=>[i(e(B),{severity:r(o.risk_level),value:o.risk_level},null,8,["severity","value"])]),_:1}),i(e(f),{field:"is_internet_exposed",header:"Internet"},{body:k(({data:o})=>[t("i",{class:N(o.is_internet_exposed?"pi pi-check text-danger":"pi pi-minus")},null,2)]),_:1}),i(e(f),{header:"Actions"},{body:k(({data:o})=>[i(e(F),{icon:"pi pi-eye",text:"",onClick:C=>y(o)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),e(a).pagination.total>e(a).pagination.pageSize?(w(),T(e(j),{key:1,rows:e(a).pagination.pageSize,totalRecords:e(a).pagination.total,first:(e(a).pagination.page-1)*e(a).pagination.pageSize,onPage:P},null,8,["rows","totalRecords","first"])):S("",!0)]))}},ee=R(Y,[["__scopeId","data-v-788ad7f6"]]);export{ee as default};
