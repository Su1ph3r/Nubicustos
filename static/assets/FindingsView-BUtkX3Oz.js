import{_ as B,r as V,c as $,w as N,a as C,o as w,e as t,F as G,b as K,x as i,y as S,q as Q,f as P,n as O,t as v,u as g,A as b,B as R,j as J,C as W}from"./index-D2tkqljB.js";import{u as I}from"./findings-CENKQXQq.js";import{F as X}from"./FindingDetail-KCli9JbA.js";const Y={class:"filters-container"},Z={class:"severity-quick-filters"},ee=["onClick"],te={class:"severity-label"},le={class:"severity-count"},se={class:"filters-row"},oe={class:"filter-group"},ae={class:"filter-group"},ie={class:"filter-group"},ne={class:"filter-group"},re={class:"filter-group"},de={class:"filter-actions"},ue={__name:"FindingFilters",emits:["filter-change"],setup(c,{emit:x}){const e=x,l=I(),f=V(l.filters.search||""),p=V(l.filters.severity?[l.filters.severity]:[]),y=V(l.filters.status?[l.filters.status]:[]),F=V(l.filters.tool||null),o=V(l.filters.cloud_provider||null);let s=null;const _=[{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"}],d=[{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"},{label:"Info",value:"info"}],h=[{label:"Open",value:"open"},{label:"Closed",value:"closed"},{label:"Mitigated",value:"mitigated"},{label:"Accepted",value:"accepted"}],k=$(()=>l.filterOptions.tools.map(r=>({label:r,value:r}))),m=$(()=>l.filterOptions.cloudProviders.map(r=>({label:r,value:r}))),T=$(()=>l.hasFilters),z=()=>{clearTimeout(s),s=setTimeout(()=>{l.setFilter("search",f.value),e("filter-change")},300)},n=()=>{const r=p.value.length>0?p.value.join(","):null;l.setFilter("severity",r),e("filter-change")},A=r=>{p.value.indexOf(r)===-1?p.value=[r]:p.value=[],n()},q=()=>{const r=y.value.length>0?y.value.join(","):null;l.setFilter("status",r),e("filter-change")},U=()=>{l.setFilter("tool",F.value),e("filter-change")},M=()=>{l.setFilter("cloud_provider",o.value),e("filter-change")},j=()=>{f.value="",p.value=[],y.value=[],F.value=null,o.value=null,l.clearFilters(),e("filter-change")};return N(()=>l.filters,r=>{r.search!==f.value&&(f.value=r.search||""),r.severity&&(p.value=r.severity.split(","))},{deep:!0}),(r,a)=>{const H=S("InputText"),D=S("MultiSelect"),L=S("Dropdown"),E=S("Button");return w(),C("div",Y,[t("div",Z,[(w(),C(G,null,K(_,u=>t("button",{key:u.value,class:O(["severity-quick-btn",[u.value,{active:p.value.includes(u.value)}]]),onClick:Oe=>A(u.value)},[t("span",te,v(u.label),1),t("span",le,v(g(l).summary[u.value]||0),1)],10,ee)),64))]),t("div",se,[t("div",oe,[a[5]||(a[5]=t("label",null,"Search",-1)),i(H,{modelValue:f.value,"onUpdate:modelValue":a[0]||(a[0]=u=>f.value=u),placeholder:"Search findings...",onInput:z},null,8,["modelValue"])]),t("div",ae,[a[6]||(a[6]=t("label",null,"Severity",-1)),i(D,{modelValue:p.value,"onUpdate:modelValue":a[1]||(a[1]=u=>p.value=u),options:d,optionLabel:"label",optionValue:"value",placeholder:"All Severities",display:"chip",onChange:n},null,8,["modelValue"])]),t("div",ie,[a[7]||(a[7]=t("label",null,"Status",-1)),i(D,{modelValue:y.value,"onUpdate:modelValue":a[2]||(a[2]=u=>y.value=u),options:h,optionLabel:"label",optionValue:"value",placeholder:"All Statuses",display:"chip",onChange:q},null,8,["modelValue"])]),t("div",ne,[a[8]||(a[8]=t("label",null,"Tool",-1)),i(L,{modelValue:F.value,"onUpdate:modelValue":a[3]||(a[3]=u=>F.value=u),options:k.value,optionLabel:"label",optionValue:"value",placeholder:"All Tools",showClear:"",onChange:U},null,8,["modelValue","options"])]),t("div",re,[a[9]||(a[9]=t("label",null,"Provider",-1)),i(L,{modelValue:o.value,"onUpdate:modelValue":a[4]||(a[4]=u=>o.value=u),options:m.value,optionLabel:"label",optionValue:"value",placeholder:"All Providers",showClear:"",onChange:M},null,8,["modelValue","options"])]),t("div",de,[T.value?(w(),Q(E,{key:0,label:"Clear",icon:"pi pi-times",severity:"secondary",size:"small",onClick:j})):P("",!0)])])])}}},ce=B(ue,[["__scopeId","data-v-5be388d4"]]),pe={class:"findings-table-container"},ge={class:"empty-state"},ve={key:0},fe={class:"loading-state"},he={class:"tool-badge"},me={class:"finding-title-cell"},ye={class:"title"},_e={key:0,class:"resource-name"},be={class:"pagination-container"},Se={class:"pagination-info"},we={__name:"FindingsTable",props:{findings:{type:Array,default:()=>[]},total:{type:Number,default:0},page:{type:Number,default:1},pageSize:{type:Number,default:50},loading:{type:Boolean,default:!1},hasFilters:{type:Boolean,default:!1},sortField:{type:String,default:"risk_score"},sortOrder:{type:Number,default:-1}},emits:["page-change","sort-change"],setup(c,{emit:x}){const e=c,l=x,f=V([]),p=$(()=>e.total===0?0:(e.page-1)*e.pageSize+1),y=$(()=>{const d=e.page*e.pageSize;return d>e.total?e.total:d}),F=d=>d?new Date(d).toLocaleDateString():"N/A",o=d=>{l("page-change",{page:d.page+1,pageSize:d.rows})},s=d=>{l("page-change",{page:d.page+1,pageSize:d.rows})},_=d=>{l("sort-change",{field:d.sortField,order:d.sortOrder})};return(d,h)=>{const k=S("ProgressSpinner"),m=S("Column"),T=S("DataTable"),z=S("Paginator");return w(),C("div",pe,[i(T,{value:c.findings,loading:c.loading,rows:c.pageSize,totalRecords:c.total,lazy:!0,sortField:c.sortField,sortOrder:c.sortOrder,expandedRows:f.value,"onUpdate:expandedRows":h[0]||(h[0]=n=>f.value=n),dataKey:"id",onPage:o,onSort:_,scrollable:"",scrollHeight:"flex",stripedRows:"",showGridlines:"",class:"findings-table"},{empty:b(()=>[t("div",ge,[h[1]||(h[1]=t("i",{class:"pi pi-inbox"},null,-1)),h[2]||(h[2]=t("p",null,"No findings found",-1)),c.hasFilters?(w(),C("span",ve,"Try adjusting your filters")):P("",!0)])]),loading:b(()=>[t("div",fe,[i(k),h[3]||(h[3]=t("span",null,"Loading findings...",-1))])]),expansion:b(({data:n})=>[i(X,{finding:n},null,8,["finding"])]),default:b(()=>[i(m,{expander:"",style:{width:"3rem"}}),i(m,{field:"severity",header:"Severity",sortable:!0,style:{width:"100px"}},{body:b(({data:n})=>[t("span",{class:O(["severity-badge",n.severity])},v(n.severity),3)]),_:1}),i(m,{field:"tool",header:"Tool",sortable:!0,style:{width:"120px"}},{body:b(({data:n})=>[t("span",he,v(n.tool),1)]),_:1}),i(m,{field:"title",header:"Finding",sortable:!0,style:{"min-width":"300px"}},{body:b(({data:n})=>[t("div",me,[t("span",ye,v(n.title),1),n.resource_name?(w(),C("span",_e,v(n.resource_name),1)):P("",!0)])]),_:1}),i(m,{field:"resource_type",header:"Resource Type",sortable:!0,style:{width:"150px"}}),i(m,{field:"region",header:"Region",sortable:!0,style:{width:"120px"}}),i(m,{field:"status",header:"Status",sortable:!0,style:{width:"100px"}},{body:b(({data:n})=>[t("span",{class:O(["status-badge",n.status])},v(n.status),3)]),_:1}),i(m,{field:"scan_date",header:"Date",sortable:!0,style:{width:"150px"}},{body:b(({data:n})=>[R(v(F(n.scan_date)),1)]),_:1})]),_:1},8,["value","loading","rows","totalRecords","sortField","sortOrder","expandedRows"]),t("div",be,[t("div",Se," Showing "+v(p.value)+" to "+v(y.value)+" of "+v(c.total)+" findings ",1),i(z,{rows:c.pageSize,totalRecords:c.total,first:(c.page-1)*c.pageSize,rowsPerPageOptions:[25,50,100],onPage:s},null,8,["rows","totalRecords","first"])])])}}},Fe=B(we,[["__scopeId","data-v-19defb4c"]]),Ce={class:"findings-view"},xe={class:"findings-header"},Ve={class:"header-content"},$e={class:"subtitle"},Pe={key:0},ke={class:"header-actions"},Te={key:0,class:"error-message"},ze={__name:"FindingsView",setup(c){const x=W(),e=I(),l=()=>{e.fetchFindings()},f=()=>{l()},p=({page:o,pageSize:s})=>{s!==e.pageSize&&e.setPageSize(s),o!==e.page&&e.setPage(o),l()},y=({field:o,order:s})=>{e.setSort(o,s),l()},F=()=>{const o=new URLSearchParams,s=e.filters;s.severity&&o.set("severity",s.severity),s.status&&o.set("status",s.status),s.tool&&o.set("tool",s.tool),s.cloud_provider&&o.set("cloud_provider",s.cloud_provider),o.set("include_remediation","true");const _=o.toString();window.open(`/api/exports/csv${_?`?${_}`:""}`,"_blank")};return J(async()=>{await e.fetchSummary(),x.query.severity&&e.setFilter("severity",x.query.severity),l()}),N(()=>x.query,o=>{o.severity&&(e.setFilter("severity",o.severity),l())}),(o,s)=>{const _=S("Button");return w(),C("div",Ce,[t("div",xe,[t("div",Ve,[s[0]||(s[0]=t("h2",null,"Security Findings",-1)),t("p",$e,[R(v(g(e).total)+" findings ",1),g(e).hasFilters?(w(),C("span",Pe,"(filtered)")):P("",!0)])]),t("div",ke,[i(_,{label:"Export CSV",icon:"pi pi-download",severity:"secondary",onClick:F})])]),i(ce,{onFilterChange:f}),g(e).error?(w(),C("div",Te,[s[1]||(s[1]=t("i",{class:"pi pi-exclamation-triangle"},null,-1)),R(" "+v(g(e).error)+" ",1),i(_,{label:"Retry",size:"small",onClick:l})])):P("",!0),i(Fe,{findings:g(e).findings,total:g(e).total,page:g(e).page,"page-size":g(e).pageSize,loading:g(e).loading,"has-filters":g(e).hasFilters,"sort-field":g(e).sortBy,"sort-order":g(e).sortOrder==="asc"?1:-1,onPageChange:p,onSortChange:y},null,8,["findings","total","page","page-size","loading","has-filters","sort-field","sort-order"])])}}},Le=B(ze,[["__scopeId","data-v-ace46ea3"]]);export{Le as default};
