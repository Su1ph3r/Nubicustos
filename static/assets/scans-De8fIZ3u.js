import{d as N,r as c,c as l}from"./index-D2tkqljB.js";const p="/api",J=N("scans",()=>{const o=c([]),g=c(null),v=c([]),r=c(null),d=c(!1),i=c(null),u=c({}),h=c({});let S=null;function F(e){S=e}function m(e,t,a,n=4e3){S&&S.add({severity:e,summary:t,detail:a,life:n})}const w=c({page:1,pageSize:20,total:0}),k=l(()=>o.value.filter(e=>e.status==="running")),b=l(()=>o.value.slice(0,5)),j=l(()=>k.value.length>0),C=l(()=>{var e,t;return((t=(e=r.value)==null?void 0:e.summary)==null?void 0:t.aws)||"unknown"}),P=l(()=>{var e,t;return((t=(e=r.value)==null?void 0:e.summary)==null?void 0:t.azure)||"unknown"}),T=l(()=>{var e,t;return((t=(e=r.value)==null?void 0:e.summary)==null?void 0:t.gcp)||"unknown"}),x=l(()=>{var e,t;return((t=(e=r.value)==null?void 0:e.summary)==null?void 0:t.kubernetes)||"unknown"});async function z(e={}){d.value=!0,i.value=null;try{const t=new URLSearchParams;t.append("page",w.value.page),t.append("page_size",w.value.pageSize),e.status&&t.append("status",e.status),e.tool&&t.append("tool",e.tool);const a=await fetch(`${p}/scans?${t}`);if(!a.ok)throw new Error("Failed to fetch scans");const n=await a.json();return o.value=n.scans,w.value.total=n.total,n.scans}catch(t){return i.value=t.message,console.error("Error fetching scans:",t),[]}finally{d.value=!1}}async function E(e){try{const t=await fetch(`${p}/scans/${e}`);if(!t.ok)throw new Error("Failed to fetch scan");const a=await t.json();return g.value=a,a}catch(t){return console.error("Error fetching scan:",t),null}}async function A(e={}){var t;d.value=!0,i.value=null;try{const a=await fetch(`${p}/scans`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({profile:e.profile||"quick",target:e.target||null,severity_filter:e.severityFilter||null,dry_run:e.dryRun||!1})});if(!a.ok){const f=await a.json().catch(()=>({}));throw new Error(f.detail||"Failed to create scan")}const n=await a.json();o.value.unshift(n);const s=((t=v.value.find(f=>f.id===e.profile))==null?void 0:t.name)||e.profile;return m("info","Scan Started",`${s} scan has been initiated`,4e3),n.scan_id&&(h.value[n.scan_id]="running",_(n.scan_id)),n}catch(a){throw i.value=a.message,a}finally{d.value=!1}}async function O(e){try{const t=await fetch(`${p}/scans/${e}`,{method:"DELETE"});if(!t.ok)throw new Error("Failed to cancel scan");y(e);const a=o.value.findIndex(n=>n.scan_id===e);return a!==-1&&(o.value[a].status="cancelled"),await t.json()}catch(t){throw i.value=t.message,t}}async function R(){try{return v.value=[{id:"quick",name:"Quick Scan",description:"5-10 minute fast security assessment",estimatedTime:"5-10 min",tools:["prowler","kubescape"]},{id:"comprehensive",name:"Full Scan",description:"Complete security audit with all tools",estimatedTime:"30-60 min",tools:["prowler","scoutsuite","kubescape","trivy","checkov"]},{id:"compliance-only",name:"Compliance",description:"Compliance-focused security checks",estimatedTime:"15-20 min",tools:["prowler","kube-bench"]}],v.value}catch(e){return console.error("Error fetching profiles:",e),[]}}async function q(){try{const e=await fetch(`${p}/credentials/status`);if(!e.ok)throw new Error("Failed to fetch credential status");return r.value=await e.json(),r.value}catch(e){return console.error("Error fetching credential status:",e),null}}function _(e,t=null,a=5e3){if(u.value[e])return;const n=async()=>{const s=await E(e);if(s){const f=o.value.findIndex(L=>L.scan_id===e);f!==-1&&(o.value[f]=s);const $=h.value[e];$&&$!==s.status&&(s.status==="completed"?m("success","Scan Completed",`Found ${s.total_findings||0} findings`,5e3):s.status==="failed"?m("error","Scan Failed","Check scan details for error information",5e3):s.status==="cancelled"&&m("warn","Scan Cancelled","The scan was cancelled",4e3)),h.value[e]=s.status,t&&t(s),["completed","failed","cancelled"].includes(s.status)&&(y(e),delete h.value[e])}};n(),u.value[e]=setInterval(n,a)}function y(e){u.value[e]&&(clearInterval(u.value[e]),delete u.value[e])}function D(){Object.keys(u.value).forEach(e=>{y(e)})}return{scans:o,currentScan:g,profiles:v,credentialStatus:r,loading:d,error:i,pagination:w,runningScans:k,recentScans:b,hasRunningScans:j,awsStatus:C,azureStatus:P,gcpStatus:T,kubernetesStatus:x,fetchScans:z,fetchScan:E,createScan:A,cancelScan:O,fetchProfiles:R,fetchCredentialStatus:q,startPolling:_,stopPolling:y,stopAllPolling:D,setToast:F}});export{J as u};
