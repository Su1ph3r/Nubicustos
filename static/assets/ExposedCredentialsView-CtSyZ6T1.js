import{d as A,r as p,c as P,_ as F,j as z,a as k,e as i,f as E,x as o,q as N,u as a,t as T,H as V,A as w,J as j,K as B,o as x,L as m,M as $}from"./index-D2tkqljB.js";const S="/api",L=A("exposedCredentials",()=>{const _=p([]),t=p(null),c=p(null),v=p(!1),u=p(null),f=p({page:1,pageSize:50,total:0}),r=p({credentialType:null,sourceType:null,cloudProvider:null,isActive:null,remediationStatus:null}),g=P(()=>_.value.filter(e=>e.is_active));async function y(){v.value=!0,u.value=null;try{const e=new URLSearchParams;e.append("page",f.value.page),e.append("page_size",f.value.pageSize),r.value.credentialType&&e.append("credential_type",r.value.credentialType),r.value.sourceType&&e.append("source_type",r.value.sourceType),r.value.cloudProvider&&e.append("cloud_provider",r.value.cloudProvider),r.value.isActive!==null&&e.append("is_active",r.value.isActive),r.value.remediationStatus&&e.append("remediation_status",r.value.remediationStatus);const d=await fetch(`${S}/exposed-credentials?${e}`);if(!d.ok)throw new Error("Failed to fetch exposed credentials");const h=await d.json();_.value=h.credentials,f.value.total=h.total}catch(e){u.value=e.message,console.error("Error fetching credentials:",e)}finally{v.value=!1}}async function l(e){v.value=!0,u.value=null;try{const d=await fetch(`${S}/exposed-credentials/${e}`);if(!d.ok)throw new Error("Failed to fetch credential");return t.value=await d.json(),t.value}catch(d){return u.value=d.message,null}finally{v.value=!1}}async function s(){try{const e=await fetch(`${S}/exposed-credentials/summary`);if(!e.ok)throw new Error("Failed to fetch summary");return c.value=await e.json(),c.value}catch(e){return console.error("Error fetching summary:",e),null}}async function n(e,d,h){try{if(!(await fetch(`${S}/exposed-credentials/${e}/remediation`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({remediation_status:d,remediation_notes:h})})).ok)throw new Error("Failed to update remediation");return await y(),!0}catch(C){throw u.value=C.message,C}}function b(e){r.value={...r.value,...e},f.value.page=1,y()}return{credentials:_,currentCredential:t,summary:c,loading:v,error:u,pagination:f,filters:r,activeCredentials:g,fetchCredentials:y,fetchCredential:l,fetchSummary:s,updateRemediation:n,setFilters:b}}),R={class:"exposed-credentials-view"},U={key:0,class:"summary-cards"},H={class:"summary-card critical"},I={class:"card-value"},J={class:"summary-card high"},M={class:"card-value"},q={class:"filters-section"},D={class:"location-text"},K={__name:"ExposedCredentialsView",setup(_){const t=L(),c=p({credentialType:null,sourceType:null}),v=["aws_access_key","api_key","password","token","certificate","ssh_key"],u=["env_var","config_file","ssm_parameter","secrets_manager","lambda_env"];function f(l,s){return l?l.length>s?l.slice(0,s)+"...":l:""}function r(l){return{pending:"warning",in_progress:"info",resolved:"success",accepted:"secondary"}[l]||"secondary"}function g(){t.setFilters(c.value)}function y(l){t.pagination.page=l.page+1,t.fetchCredentials()}return z(()=>{t.fetchCredentials(),t.fetchSummary()}),(l,s)=>(x(),k("div",R,[s[4]||(s[4]=i("div",{class:"page-header"},[i("div",{class:"header-content"},[i("h1",null,"Exposed Credentials"),i("p",{class:"subtitle"},"Credentials discovered in scan data")])],-1)),a(t).summary?(x(),k("div",U,[i("div",H,[i("div",I,T(a(t).summary.total),1),s[2]||(s[2]=i("div",{class:"card-label"},"Total",-1))]),i("div",J,[i("div",M,T(a(t).summary.active),1),s[3]||(s[3]=i("div",{class:"card-label"},"Active",-1))])])):E("",!0),i("div",q,[o(a(V),{modelValue:c.value.credentialType,"onUpdate:modelValue":s[0]||(s[0]=n=>c.value.credentialType=n),options:v,placeholder:"Credential Type",onChange:g,class:"filter-dropdown"},null,8,["modelValue"]),o(a(V),{modelValue:c.value.sourceType,"onUpdate:modelValue":s[1]||(s[1]=n=>c.value.sourceType=n),options:u,placeholder:"Source Type",onChange:g,class:"filter-dropdown"},null,8,["modelValue"])]),o(a(j),{value:a(t).credentials,loading:a(t).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:w(()=>[o(a(m),{field:"credential_type",header:"Type"}),o(a(m),{field:"credential_name",header:"Name"}),o(a(m),{field:"source_type",header:"Source"}),o(a(m),{field:"source_location",header:"Location"},{body:w(({data:n})=>[i("span",D,T(f(n.source_location,50)),1)]),_:1}),o(a(m),{field:"cloud_provider",header:"Provider"}),o(a(m),{field:"is_active",header:"Active"},{body:w(({data:n})=>[o(a($),{severity:n.is_active?"danger":"success",value:n.is_active?"Yes":"No"},null,8,["severity","value"])]),_:1}),o(a(m),{field:"remediation_status",header:"Status"},{body:w(({data:n})=>[o(a($),{severity:r(n.remediation_status),value:n.remediation_status},null,8,["severity","value"])]),_:1})]),_:1},8,["value","loading"]),a(t).pagination.total>a(t).pagination.pageSize?(x(),N(a(B),{key:1,rows:a(t).pagination.pageSize,totalRecords:a(t).pagination.total,first:(a(t).pagination.page-1)*a(t).pagination.pageSize,onPage:y},null,8,["rows","totalRecords","first"])):E("",!0)]))}},Y=F(K,[["__scopeId","data-v-7f0900c0"]]);export{Y as default};
