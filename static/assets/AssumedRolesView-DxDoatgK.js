import{d as E,r as m,c as T,_ as x,j as z,a as A,e as n,f as $,x as l,q as M,u as s,I as S,t as k,A as _,J as F,K as L,o as C,L as f,M as R,n as q}from"./index-D2tkqljB.js";const g="/api",B=E("assumedRoles",()=>{const h=m([]),a=m(null),p=m(null),y=m(!1),i=m(null),d=m({page:1,pageSize:50,total:0}),t=m({cloudProvider:null,sourcePrincipalType:null,isCrossAccount:null,riskLevel:null,neo4jSynced:null}),w=T(()=>h.value.filter(e=>e.is_cross_account));async function v(){y.value=!0,i.value=null;try{const e=new URLSearchParams;e.append("page",d.value.page),e.append("page_size",d.value.pageSize),t.value.cloudProvider&&e.append("cloud_provider",t.value.cloudProvider),t.value.sourcePrincipalType&&e.append("source_principal_type",t.value.sourcePrincipalType),t.value.isCrossAccount!==null&&e.append("is_cross_account",t.value.isCrossAccount),t.value.riskLevel&&e.append("risk_level",t.value.riskLevel),t.value.neo4jSynced!==null&&e.append("neo4j_synced",t.value.neo4jSynced);const o=await fetch(`${g}/assumed-roles?${e}`);if(!o.ok)throw new Error("Failed to fetch assumed role mappings");const u=await o.json();h.value=u.mappings,d.value.total=u.total}catch(e){i.value=e.message,console.error("Error fetching mappings:",e)}finally{y.value=!1}}async function r(){y.value=!0,i.value=null;try{const e=new URLSearchParams;e.append("page",d.value.page),e.append("page_size",d.value.pageSize);const o=await fetch(`${g}/assumed-roles/cross-account?${e}`);if(!o.ok)throw new Error("Failed to fetch cross-account roles");const u=await o.json();h.value=u.mappings,d.value.total=u.total}catch(e){i.value=e.message}finally{y.value=!1}}async function c(e=2){try{const o=await fetch(`${g}/assumed-roles/chains?min_depth=${e}`);if(!o.ok)throw new Error("Failed to fetch chains");return await o.json()}catch(o){throw i.value=o.message,o}}async function j(){try{const e=await fetch(`${g}/assumed-roles/summary`);if(!e.ok)throw new Error("Failed to fetch summary");return p.value=await e.json(),p.value}catch(e){return console.error("Error fetching summary:",e),null}}async function b(e,o=!1){y.value=!0,i.value=null;try{const u=await fetch(`${g}/assumed-roles/sync-neo4j`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({mapping_ids:e,sync_all:o})});if(!u.ok)throw new Error("Failed to sync to Neo4j");return await v(),await u.json()}catch(u){throw i.value=u.message,u}finally{y.value=!1}}async function N(e){try{const o=await fetch(`${g}/assumed-roles/${e}/neo4j-query`);if(!o.ok)throw new Error("Failed to get Neo4j query");return await o.json()}catch(o){throw i.value=o.message,o}}function P(e){t.value={...t.value,...e},d.value.page=1,v()}return{mappings:h,currentMapping:a,summary:p,loading:y,error:i,pagination:d,filters:t,crossAccountMappings:w,fetchMappings:v,fetchCrossAccount:r,fetchChains:c,fetchSummary:j,syncToNeo4j:b,getNeo4jQuery:N,setFilters:P}}),V={class:"assumed-roles-view"},I={class:"page-header"},Q={class:"header-actions"},O={key:0,class:"summary-cards"},D={class:"summary-card info"},J={class:"card-value"},U={class:"summary-card high"},G={class:"card-value"},K={class:"summary-card medium"},Y={class:"card-value"},H={class:"filters-section"},W={__name:"AssumedRolesView",setup(h){const a=B(),p=m(!1);function y(v){return{critical:"danger",high:"warning",medium:"info",low:"success"}[v]||"secondary"}function i(){p.value=!p.value,p.value?a.fetchCrossAccount():a.fetchMappings()}async function d(){await a.syncToNeo4j(null,!0)}async function t(v){const r=await a.getNeo4jQuery(v);console.log("Cypher Query:",r.cypher_query)}function w(v){a.pagination.page=v.page+1,p.value?a.fetchCrossAccount():a.fetchMappings()}return z(()=>{a.fetchMappings(),a.fetchSummary()}),(v,r)=>(C(),A("div",V,[n("div",I,[r[0]||(r[0]=n("div",{class:"header-content"},[n("h1",null,"Assumed Role Mapper"),n("p",{class:"subtitle"},"Role assumption relationships for visualization")],-1)),n("div",Q,[l(s(S),{label:"Sync to Neo4j",icon:"pi pi-sync",onClick:d,loading:s(a).loading},null,8,["loading"])])]),s(a).summary?(C(),A("div",O,[n("div",D,[n("div",J,k(s(a).summary.total_mappings),1),r[1]||(r[1]=n("div",{class:"card-label"},"Total Mappings",-1))]),n("div",U,[n("div",G,k(s(a).summary.cross_account),1),r[2]||(r[2]=n("div",{class:"card-label"},"Cross-Account",-1))]),n("div",K,[n("div",Y,k(s(a).summary.external_id_required),1),r[3]||(r[3]=n("div",{class:"card-label"},"External ID Required",-1))])])):$("",!0),n("div",H,[l(s(S),{label:p.value?"Show All":"Show Cross-Account",icon:p.value?"pi pi-list":"pi pi-share-alt",onClick:i},null,8,["label","icon"])]),l(s(F),{value:s(a).mappings,loading:s(a).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:_(()=>[l(s(f),{field:"source_principal_name",header:"Source"}),l(s(f),{field:"source_principal_type",header:"Source Type"}),l(s(f),{field:"target_role_name",header:"Target Role"}),l(s(f),{field:"target_account_id",header:"Target Account"}),l(s(f),{field:"is_cross_account",header:"Cross-Account"},{body:_(({data:c})=>[l(s(R),{severity:c.is_cross_account?"warning":"secondary",value:c.is_cross_account?"Yes":"No"},null,8,["severity","value"])]),_:1}),l(s(f),{field:"risk_level",header:"Risk"},{body:_(({data:c})=>[l(s(R),{severity:y(c.risk_level),value:c.risk_level},null,8,["severity","value"])]),_:1}),l(s(f),{field:"neo4j_synced",header:"Synced"},{body:_(({data:c})=>[n("i",{class:q(c.neo4j_synced?"pi pi-check text-success":"pi pi-times text-danger")},null,2)]),_:1}),l(s(f),{header:"Actions"},{body:_(({data:c})=>[l(s(S),{icon:"pi pi-code",text:"",onClick:j=>t(c.id),title:"Get Cypher Query"},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),s(a).pagination.total>s(a).pagination.pageSize?(C(),M(s(L),{key:1,rows:s(a).pagination.pageSize,totalRecords:s(a).pagination.total,first:(s(a).pagination.page-1)*s(a).pagination.pageSize,onPage:w},null,8,["rows","totalRecords","first"])):$("",!0)]))}},Z=x(W,[["__scopeId","data-v-cc411793"]]);export{Z as default};
