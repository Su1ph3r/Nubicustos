import{d as ae,r as b,c as R,N as ie,_ as te,D as ne,j as le,k as oe,a as c,e as s,f as y,x as r,q as z,O as re,P as ce,u as e,I as P,n as se,t as h,A as w,J as ue,K as de,Q as pe,o,L as C,M as A,S as ve,T as F,F as L,b as M,B as me}from"./index-D2tkqljB.js";import{u as j}from"./executions-CLlZP_1s.js";const I="/api",_e=ae("enumerateIam",()=>{const $=b([]),i=b(null),N=b(null),E=b(!1),g=b(null),p=b(null),m=b({page:1,pageSize:50,total:0}),v=b({principalType:null,privescCapable:null,adminCapable:null}),l=R(()=>$.value.filter(t=>t.privesc_capable||t.admin_capable||t.data_access_capable));async function S(){E.value=!0,g.value=null;try{const t=new URLSearchParams;t.append("page",m.value.page),t.append("page_size",m.value.pageSize),v.value.principalType&&t.append("principal_type",v.value.principalType),v.value.privescCapable!==null&&t.append("privesc_capable",v.value.privescCapable),v.value.adminCapable!==null&&t.append("admin_capable",v.value.adminCapable);const u=await fetch(`${I}/enumerate-iam?${t}`);if(!u.ok)throw new Error("Failed to fetch enumerate-iam results");const _=await u.json();$.value=_.results,m.value.total=_.total}catch(t){g.value=t.message,console.error("Error fetching enumerate-iam results:",t)}finally{E.value=!1}}async function D(){E.value=!0,g.value=null;try{const t=new URLSearchParams;t.append("page",m.value.page),t.append("page_size",m.value.pageSize);const u=await fetch(`${I}/enumerate-iam/high-risk?${t}`);if(!u.ok)throw new Error("Failed to fetch high-risk principals");const _=await u.json();$.value=_.results,m.value.total=_.total}catch(t){g.value=t.message}finally{E.value=!1}}async function T(){try{const t=await fetch(`${I}/enumerate-iam/summary`);if(!t.ok)throw new Error("Failed to fetch summary");return N.value=await t.json(),N.value}catch(t){return console.error("Error fetching summary:",t),null}}async function H(t){try{const u=await fetch(`${I}/enumerate-iam/${t}/permissions`);if(!u.ok)throw new Error("Failed to fetch permissions");return await u.json()}catch(u){throw g.value=u.message,u}}async function V(t){E.value=!0,g.value=null;try{const _=ie().getSessionCredentials("aws"),n={...t};_&&(n.access_key=_.access_key_id,n.secret_key=_.secret_access_key,_.session_token&&(n.session_token=_.session_token));const a=await fetch(`${I}/enumerate-iam/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!a.ok)throw new Error("Failed to run enumerate-iam");const f=await a.json();return p.value=f,f.status==="running"&&f.execution_id&&j().startPolling(f.execution_id,d=>{p.value=d,d.status==="completed"&&(S(),T())}),f}catch(u){throw g.value=u.message,u}finally{E.value=!1}}async function B(){var t;(t=p.value)!=null&&t.execution_id&&(await j().stopExecution(p.value.execution_id),p.value=null)}async function O(){var t;return(t=p.value)!=null&&t.execution_id?await j().fetchExecutionLogs(p.value.execution_id):null}function U(t){v.value={...v.value,...t},m.value.page=1,S()}return{results:$,currentResult:i,summary:N,loading:E,error:g,pagination:m,filters:v,currentExecution:p,highRiskPrincipals:l,fetchResults:S,fetchHighRisk:D,fetchSummary:T,fetchPermissions:H,runEnumeration:V,stopCurrentExecution:B,getExecutionLogs:O,setFilters:U}}),fe={class:"enumerate-iam-view"},he={class:"page-header"},ge={class:"header-actions"},ye={class:"execution-header"},be={class:"execution-info"},xe={class:"execution-title"},ke={class:"execution-meta"},we={key:0,class:"execution-id"},Ee={key:0,class:"execution-error"},Se={key:1,class:"execution-logs"},Ce={key:2,class:"execution-actions"},Ae={key:1,class:"summary-cards"},Pe={class:"summary-card info"},Re={class:"card-value"},$e={class:"summary-card critical"},Ne={class:"card-value"},Ie={class:"summary-card high"},De={class:"card-value"},Te={class:"summary-card medium"},ze={class:"card-value"},Fe={class:"filters-section"},Le={key:0,class:"permissions-dialog"},Me={class:"principal-info"},je={class:"info-row"},He={class:"info-value"},Ve={class:"info-row"},Be={class:"capabilities-row"},Oe={class:"permissions-list"},Ue={key:0,class:"no-permissions"},We={class:"permissions-list"},Ye={key:0,class:"no-permissions"},qe={class:"permissions-list"},Je={key:0,class:"no-permissions"},Ke={class:"permissions-list"},Qe={key:0,class:"no-permissions"},Ge={key:1,class:"loading-permissions"},Xe={__name:"EnumerateIamView",setup($){const i=_e(),N=j(),E=ie(),g=ne(),p=b(!1),m=b(null),v=b(!1),l=b(null),S=R(()=>{var n;return((n=E.sessionCredentials)==null?void 0:n.aws)!==null}),D=R(()=>{var n;return((n=i.currentExecution)==null?void 0:n.status)==="running"}),T=R(()=>{var a;const n=(a=i.currentExecution)==null?void 0:a.status;return{"status-running":n==="running","status-completed":n==="completed","status-failed":n==="failed","status-pending":n==="pending"}}),H=R(()=>{var f;const n=(f=i.currentExecution)==null?void 0:f.status;return{running:"pi pi-spin pi-spinner",completed:"pi pi-check-circle",failed:"pi pi-times-circle",pending:"pi pi-clock"}[n]||"pi pi-info-circle"}),V=R(()=>{var f;const n=(f=i.currentExecution)==null?void 0:f.status;return{running:"IAM enumeration running...",completed:"IAM enumeration completed",failed:"IAM enumeration failed",pending:"IAM enumeration pending"}[n]||"IAM enumeration"});function B(){p.value=!p.value,p.value?i.fetchHighRisk():i.fetchResults()}async function O(n){l.value=null,v.value=!0;try{const a=await i.fetchPermissions(n);l.value=a}catch{g.add({severity:"error",summary:"Error",detail:"Failed to load permissions",life:3e3}),v.value=!1}}async function U(){if(!S.value){g.add({severity:"warn",summary:"No Credentials",detail:"Select an AWS profile in Credentials first",life:3e3});return}m.value=null;try{await i.runEnumeration({})}catch(n){g.add({severity:"error",summary:"Error",detail:n.message,life:5e3})}}async function t(){await i.stopCurrentExecution()}function u(){i.currentExecution=null,m.value=null}function _(n){i.pagination.page=n.page+1,p.value?i.fetchHighRisk():i.fetchResults()}return le(()=>{i.fetchResults(),i.fetchSummary()}),oe(()=>{var n;(n=i.currentExecution)!=null&&n.execution_id&&N.stopPolling(i.currentExecution.execution_id)}),(n,a)=>{var W;const f=ce("tooltip");return o(),c("div",fe,[s("div",he,[a[2]||(a[2]=s("div",{class:"header-content"},[s("h1",null,"enumerate-iam"),s("p",{class:"subtitle"},"IAM permission enumeration results")],-1)),s("div",ge,[D.value?(o(),z(e(P),{key:1,label:"Stop",icon:"pi pi-stop",severity:"danger",onClick:t})):re((o(),z(e(P),{key:0,label:"Run Enumeration",icon:"pi pi-play",onClick:U,loading:e(i).loading,disabled:!S.value},null,8,["loading","disabled"])),[[f,S.value?"":"Select AWS profile in Credentials first",void 0,{left:!0}]])])]),e(i).currentExecution?(o(),c("div",{key:0,class:se(["execution-panel",T.value])},[s("div",ye,[s("div",be,[s("i",{class:se([H.value,"execution-icon"])},null,2),s("span",xe,h(V.value),1)]),s("div",ke,[e(i).currentExecution.execution_id?(o(),c("span",we," ID: "+h(e(i).currentExecution.execution_id),1)):y("",!0)])]),e(i).currentExecution.error?(o(),c("div",Ee,h(e(i).currentExecution.error),1)):y("",!0),m.value?(o(),c("div",Se,[s("pre",null,h(m.value),1)])):y("",!0),D.value?y("",!0):(o(),c("div",Ce,[r(e(P),{label:"Dismiss",text:"",size:"small",onClick:u}),e(i).currentExecution.status==="completed"?(o(),z(e(P),{key:0,label:"View Results",size:"small",onClick:a[0]||(a[0]=d=>e(i).fetchResults())})):y("",!0)]))],2)):y("",!0),e(i).summary?(o(),c("div",Ae,[s("div",Pe,[s("div",Re,h(e(i).summary.total_principals),1),a[3]||(a[3]=s("div",{class:"card-label"},"Total Principals",-1))]),s("div",$e,[s("div",Ne,h(e(i).summary.admin_capable),1),a[4]||(a[4]=s("div",{class:"card-label"},"Admin Capable",-1))]),s("div",Ie,[s("div",De,h(e(i).summary.privesc_capable),1),a[5]||(a[5]=s("div",{class:"card-label"},"Privesc Capable",-1))]),s("div",Te,[s("div",ze,h(e(i).summary.data_access_capable),1),a[6]||(a[6]=s("div",{class:"card-label"},"Data Access",-1))])])):y("",!0),s("div",Fe,[r(e(P),{label:p.value?"Show All":"Show High Risk",icon:p.value?"pi pi-list":"pi pi-exclamation-triangle",onClick:B},null,8,["label","icon"])]),r(e(ue),{value:e(i).results,loading:e(i).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:w(()=>[r(e(C),{field:"principal_name",header:"Principal"}),r(e(C),{field:"principal_type",header:"Type"}),r(e(C),{field:"permission_count",header:"Permissions"}),r(e(C),{field:"privesc_capable",header:"Privesc"},{body:w(({data:d})=>[r(e(A),{severity:d.privesc_capable?"danger":"success",value:d.privesc_capable?"Yes":"No"},null,8,["severity","value"])]),_:1}),r(e(C),{field:"admin_capable",header:"Admin"},{body:w(({data:d})=>[r(e(A),{severity:d.admin_capable?"danger":"success",value:d.admin_capable?"Yes":"No"},null,8,["severity","value"])]),_:1}),r(e(C),{field:"data_access_capable",header:"Data Access"},{body:w(({data:d})=>[r(e(A),{severity:d.data_access_capable?"warning":"success",value:d.data_access_capable?"Yes":"No"},null,8,["severity","value"])]),_:1}),r(e(C),{header:"Actions"},{body:w(({data:d})=>[r(e(P),{icon:"pi pi-eye",text:"",onClick:Y=>O(d.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),e(i).pagination.total>e(i).pagination.pageSize?(o(),z(e(de),{key:2,rows:e(i).pagination.pageSize,totalRecords:e(i).pagination.total,first:(e(i).pagination.page-1)*e(i).pagination.pageSize,onPage:_},null,8,["rows","totalRecords","first"])):y("",!0),r(e(pe),{visible:v.value,"onUpdate:visible":a[1]||(a[1]=d=>v.value=d),header:((W=l.value)==null?void 0:W.principal_name)||"Permission Details",style:{width:"800px",maxWidth:"95vw"},modal:!0,dismissableMask:!0},{default:w(()=>{var d,Y,q,J,K,Q;return[l.value?(o(),c("div",Le,[s("div",Me,[s("div",je,[a[7]||(a[7]=s("span",{class:"info-label"},"Principal ARN:",-1)),s("code",He,h(l.value.principal_arn||"N/A"),1)]),s("div",Ve,[a[8]||(a[8]=s("span",{class:"info-label"},"Total Confirmed:",-1)),r(e(A),{value:String(l.value.total_confirmed),severity:"info"},null,8,["value"])])]),s("div",Be,[r(e(A),{severity:(d=l.value.capabilities)!=null&&d.admin_capable?"danger":"success",value:(Y=l.value.capabilities)!=null&&Y.admin_capable?"Admin Capable":"No Admin",class:"capability-tag"},null,8,["severity","value"]),r(e(A),{severity:(q=l.value.capabilities)!=null&&q.privesc_capable?"danger":"success",value:(J=l.value.capabilities)!=null&&J.privesc_capable?"Privesc Capable":"No Privesc",class:"capability-tag"},null,8,["severity","value"]),r(e(A),{severity:(K=l.value.capabilities)!=null&&K.data_access_capable?"warning":"success",value:(Q=l.value.capabilities)!=null&&Q.data_access_capable?"Data Access":"No Data Access",class:"capability-tag"},null,8,["severity","value"])]),r(e(ve),null,{default:w(()=>{var G,X,Z,ee;return[r(e(F),{header:`Confirmed (${((G=l.value.confirmed_permissions)==null?void 0:G.length)||0})`},{default:w(()=>{var x;return[s("div",Oe,[(o(!0),c(L,null,M(l.value.confirmed_permissions,k=>(o(),c("div",{key:k,class:"permission-item confirmed"},[a[9]||(a[9]=s("i",{class:"pi pi-check-circle"},null,-1)),s("code",null,h(k),1)]))),128)),(x=l.value.confirmed_permissions)!=null&&x.length?y("",!0):(o(),c("div",Ue," No confirmed permissions found "))])]}),_:1},8,["header"]),r(e(F),{header:`High Risk (${((X=l.value.high_risk_permissions)==null?void 0:X.length)||0})`},{default:w(()=>{var x;return[s("div",We,[(o(!0),c(L,null,M(l.value.high_risk_permissions,k=>(o(),c("div",{key:k,class:"permission-item high-risk"},[a[10]||(a[10]=s("i",{class:"pi pi-exclamation-triangle"},null,-1)),s("code",null,h(k),1)]))),128)),(x=l.value.high_risk_permissions)!=null&&x.length?y("",!0):(o(),c("div",Ye," No high-risk permissions found "))])]}),_:1},8,["header"]),r(e(F),{header:`Denied (${((Z=l.value.denied_permissions)==null?void 0:Z.length)||0})`},{default:w(()=>{var x;return[s("div",qe,[(o(!0),c(L,null,M(l.value.denied_permissions,k=>(o(),c("div",{key:k,class:"permission-item denied"},[a[11]||(a[11]=s("i",{class:"pi pi-times-circle"},null,-1)),s("code",null,h(k),1)]))),128)),(x=l.value.denied_permissions)!=null&&x.length?y("",!0):(o(),c("div",Je," No denied permissions recorded "))])]}),_:1},8,["header"]),r(e(F),{header:`Errors (${((ee=l.value.error_permissions)==null?void 0:ee.length)||0})`},{default:w(()=>{var x;return[s("div",Ke,[(o(!0),c(L,null,M(l.value.error_permissions,k=>(o(),c("div",{key:k,class:"permission-item error"},[a[12]||(a[12]=s("i",{class:"pi pi-info-circle"},null,-1)),s("code",null,h(k),1)]))),128)),(x=l.value.error_permissions)!=null&&x.length?y("",!0):(o(),c("div",Qe," No error permissions recorded "))])]}),_:1},8,["header"])]}),_:1})])):(o(),c("div",Ge,[...a[13]||(a[13]=[s("i",{class:"pi pi-spin pi-spinner"},null,-1),me(" Loading permissions... ",-1)])]))]}),_:1},8,["visible","header"])])}}},ss=te(Xe,[["__scopeId","data-v-3cd3152c"]]);export{ss as default};
