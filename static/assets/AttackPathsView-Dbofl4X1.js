import{d as H,r as _,c as D,_ as O,y as R,a as d,o,e,n as x,t as u,E as K,x as w,f as h,B as $,F as A,b as T,D as q,A as N,G as J,j as Q,u as y,q as j}from"./index-CGJ-odjO.js";const V="/api",X=H("attackPaths",()=>{const s=_([]),v=_(null),n=_(null),f=_(!1),k=_(null),l=_({page:1,pageSize:20,total:0}),i=_({minRiskScore:null,maxRiskScore:null,exploitability:null,entryPointType:null,targetType:null}),P=D(()=>s.value.filter(a=>a.risk_score>=80)),p=D(()=>s.value.filter(a=>a.risk_score>=60&&a.risk_score<80)),c=D(()=>Object.values(i.value).some(a=>a!==null&&a!==""));async function g(){f.value=!0,k.value=null;try{const a=new URLSearchParams;a.append("page",l.value.page),a.append("page_size",l.value.pageSize),i.value.minRiskScore!==null&&a.append("min_risk_score",i.value.minRiskScore),i.value.maxRiskScore!==null&&a.append("max_risk_score",i.value.maxRiskScore),i.value.exploitability&&a.append("exploitability",i.value.exploitability),i.value.entryPointType&&a.append("entry_point_type",i.value.entryPointType),i.value.targetType&&a.append("target_type",i.value.targetType);const t=await fetch(`${V}/attack-paths?${a}`);if(!t.ok)throw new Error("Failed to fetch attack paths");const m=await t.json();s.value=m.paths,l.value.total=m.total}catch(a){k.value=a.message,console.error("Error fetching attack paths:",a)}finally{f.value=!1}}async function S(a){f.value=!0,k.value=null;try{const t=await fetch(`${V}/attack-paths/${a}`);if(!t.ok)throw new Error("Failed to fetch attack path");return v.value=await t.json(),v.value}catch(t){return k.value=t.message,console.error("Error fetching attack path:",t),null}finally{f.value=!1}}async function r(){try{const a=await fetch(`${V}/attack-paths/summary`);if(!a.ok)throw new Error("Failed to fetch summary");return n.value=await a.json(),n.value}catch(a){return console.error("Error fetching summary:",a),null}}async function C(){f.value=!0,k.value=null;try{const a=await fetch(`${V}/attack-paths/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({max_depth:5})});if(!a.ok)throw new Error("Analysis failed");const t=await a.json();return await g(),await r(),t}catch(a){throw k.value=a.message,console.error("Error analyzing paths:",a),a}finally{f.value=!1}}async function F(a,t="markdown"){try{const m=await fetch(`${V}/attack-paths/${a}/export?format=${t}`);if(!m.ok)throw new Error("Export failed");return await m.json()}catch(m){throw console.error("Error exporting path:",m),m}}async function M(a){try{if(!(await fetch(`${V}/attack-paths/${a}`,{method:"DELETE"})).ok)throw new Error("Delete failed");return s.value=s.value.filter(m=>m.id!==a),!0}catch(t){throw console.error("Error deleting path:",t),t}}function L(a){l.value.page=a,g()}function B(a){i.value={minRiskScore:a.minRiskScore,maxRiskScore:a.maxRiskScore,exploitability:a.exploitability,entryPointType:a.entryPointType,targetType:a.targetType},l.value.page=1,g()}function z(){i.value={minRiskScore:null,maxRiskScore:null,exploitability:null,entryPointType:null,targetType:null},l.value.page=1,g()}return{paths:s,currentPath:v,summary:n,loading:f,error:k,pagination:l,filters:i,criticalPaths:P,highRiskPaths:p,hasFilters:c,fetchPaths:g,fetchPath:S,fetchSummary:r,analyzePaths:C,exportPath:F,deletePath:M,setPage:L,setFilters:B,clearFilters:z}}),Y={class:"card-header"},Z={class:"risk-score"},ee={class:"path-info"},te={class:"path-name"},ae={class:"path-description"},se={class:"card-body"},ie={class:"path-flow"},le={class:"flow-node entry"},oe={class:"flow-arrow"},ne={class:"hop-count"},re={class:"flow-node target"},ce={class:"card-tags"},de={key:0,class:"tag poc"},ue={key:1,class:"tag auth"},pe={key:0,class:"services-row"},ve={key:0,class:"service-more"},me={__name:"AttackPathCard",props:{path:{type:Object,required:!0}},emits:["view","export"],setup(s){const v=s,n=D(()=>v.path.risk_score>=80?"critical":v.path.risk_score>=60?"high":v.path.risk_score>=40?"medium":"low"),f=l=>({public_s3:"Public S3",public_lambda:"Public Lambda",public_ec2:"Public EC2",public_rds:"Public RDS",public_security_group:"Open SG",exposed_credentials:"Exposed Creds",weak_iam_policy:"Weak IAM"})[l]||l,k=l=>({account_takeover:"Account Takeover",data_exfiltration:"Data Exfil",persistence:"Persistence",privilege_escalation:"Priv Esc",lateral_movement:"Lateral Move"})[l]||l;return(l,i)=>{const P=R("Button");return o(),d("div",{class:x(["attack-path-card",n.value]),onClick:i[3]||(i[3]=p=>l.$emit("view",s.path))},[e("div",Y,[e("div",{class:x(["risk-badge",n.value])},[e("span",Z,u(s.path.risk_score),1),i[4]||(i[4]=e("span",{class:"risk-label"},"Risk",-1))],2),e("div",ee,[e("h3",te,u(s.path.name),1),e("p",ae,u(s.path.description),1)]),e("div",{class:"card-actions",onClick:i[2]||(i[2]=K(()=>{},["stop"]))},[w(P,{icon:"pi pi-copy",severity:"secondary",text:"",rounded:"",title:"Export to clipboard",onClick:i[0]||(i[0]=p=>l.$emit("export",s.path))}),w(P,{icon:"pi pi-arrow-right",severity:"secondary",text:"",rounded:"",title:"View details",onClick:i[1]||(i[1]=p=>l.$emit("view",s.path))})])]),e("div",se,[e("div",ie,[e("div",le,[i[5]||(i[5]=e("i",{class:"pi pi-sign-in"},null,-1)),e("span",null,u(f(s.path.entry_point_type)),1)]),e("div",oe,[e("span",ne,u(s.path.hop_count)+" hop"+u(s.path.hop_count!==1?"s":""),1)]),e("div",re,[i[6]||(i[6]=e("i",{class:"pi pi-bullseye"},null,-1)),e("span",null,u(k(s.path.target_type)),1)])]),e("div",ce,[e("span",{class:x(["tag exploitability",s.path.exploitability])},u(s.path.exploitability),3),e("span",{class:x(["tag impact",s.path.impact])},u(s.path.impact)+" impact ",3),s.path.poc_available?(o(),d("span",de,[...i[7]||(i[7]=[e("i",{class:"pi pi-code"},null,-1),$(" PoC Available ",-1)])])):h("",!0),s.path.requires_authentication?(o(),d("span",ue,[...i[8]||(i[8]=[e("i",{class:"pi pi-lock"},null,-1),$(" Auth Required ",-1)])])):h("",!0)]),s.path.aws_services&&s.path.aws_services.length?(o(),d("div",pe,[i[9]||(i[9]=e("span",{class:"services-label"},"Services:",-1)),(o(!0),d(A,null,T(s.path.aws_services.slice(0,5),p=>(o(),d("span",{key:p,class:"service-tag"},u(p),1))),128)),s.path.aws_services.length>5?(o(),d("span",ve," +"+u(s.path.aws_services.length-5)+" more ",1)):h("",!0)])):h("",!0)])],2)}}},he=O(me,[["__scopeId","data-v-159d4995"]]),ye={class:"attack-path-detail"},ke={class:"detail-section"},ge={class:"overview-grid"},be={class:"overview-item"},fe={class:"overview-item"},we={class:"overview-item"},xe={class:"overview-item"},_e={class:"item-value"},Pe={class:"detail-section"},Se={class:"path-visualization"},$e={class:"node-icon"},Ce={class:"node-info"},Re={class:"node-name"},Ae={key:0,class:"node-resource"},Te={key:1,class:"node-region"},Ee={key:0,class:"step-connector"},Ve={key:0,class:"connector-label"},De={key:0,class:"detail-section"},Le={class:"poc-steps"},ze={class:"step-header"},Fe={class:"step-number"},Me={class:"step-name"},Be={key:0,class:"auth-badge"},je={class:"step-description"},Oe={class:"step-command"},Ie={key:0,class:"step-mitre"},qe={key:1,class:"detail-section"},Ne={class:"mitre-tags"},Ue={key:2,class:"detail-section"},We={class:"service-tags"},Ge={key:3,class:"detail-section"},He={class:"findings-list"},Ke={class:"detail-actions"},Je={__name:"AttackPathDetail",props:{path:{type:Object,required:!0}},emits:["export"],setup(s){const v=s,n=q(),f=D(()=>v.path.risk_score>=80?"critical":v.path.risk_score>=60?"high":v.path.risk_score>=40?"medium":"low"),k=p=>({entry_point:"pi pi-sign-in",resource:"pi pi-server",target:"pi pi-bullseye"})[p]||"pi pi-circle",l=p=>({TA0001:"Initial Access",TA0002:"Execution",TA0003:"Persistence",TA0004:"Privilege Escalation",TA0005:"Defense Evasion",TA0006:"Credential Access",TA0007:"Discovery",TA0008:"Lateral Movement",TA0009:"Collection",TA0010:"Exfiltration",TA0011:"Command and Control"})[p]||p,i=async p=>{try{await navigator.clipboard.writeText(p),n.add({severity:"success",summary:"Copied",detail:"Command copied to clipboard",life:2e3})}catch{n.add({severity:"error",summary:"Failed",detail:"Could not copy to clipboard",life:2e3})}},P=async()=>{var c;if(!((c=v.path.poc_steps)!=null&&c.length))return;const p=v.path.poc_steps.map(g=>`# Step ${g.step}: ${g.name}
${g.command}`).join(`

`);try{await navigator.clipboard.writeText(p),n.add({severity:"success",summary:"Copied",detail:"All commands copied to clipboard",life:2e3})}catch{n.add({severity:"error",summary:"Failed",detail:"Could not copy to clipboard",life:2e3})}};return(p,c)=>{const g=R("Button"),S=R("router-link");return o(),d("div",ye,[e("div",ke,[e("div",ge,[e("div",be,[c[1]||(c[1]=e("span",{class:"item-label"},"Risk Score",-1)),e("span",{class:x(["item-value risk-score",f.value])},u(s.path.risk_score)+"/100",3)]),e("div",fe,[c[2]||(c[2]=e("span",{class:"item-label"},"Exploitability",-1)),e("span",{class:x(["item-value tag",s.path.exploitability])},u(s.path.exploitability),3)]),e("div",we,[c[3]||(c[3]=e("span",{class:"item-label"},"Impact",-1)),e("span",{class:x(["item-value tag",s.path.impact])},u(s.path.impact),3)]),e("div",xe,[c[4]||(c[4]=e("span",{class:"item-label"},"Hops",-1)),e("span",_e,u(s.path.hop_count),1)])])]),e("div",Pe,[c[7]||(c[7]=e("h4",null,[e("i",{class:"pi pi-sitemap"}),$(" Attack Chain ")],-1)),e("div",Se,[(o(!0),d(A,null,T(s.path.nodes,(r,C)=>(o(),d("div",{key:r.id,class:"path-step"},[e("div",{class:x(["step-node",r.type])},[e("div",$e,[e("i",{class:x(k(r.type))},null,2)]),e("div",Ce,[e("span",Re,u(r.name),1),r.resource_id?(o(),d("span",Ae,u(r.resource_id),1)):h("",!0),r.region?(o(),d("span",Te,u(r.region),1)):h("",!0)])],2),C<s.path.nodes.length-1?(o(),d("div",Ee,[c[5]||(c[5]=e("div",{class:"connector-line"},null,-1)),s.path.edges[C]?(o(),d("div",Ve,u(s.path.edges[C].name),1)):h("",!0),c[6]||(c[6]=e("div",{class:"connector-arrow"},[e("i",{class:"pi pi-arrow-down"})],-1))])):h("",!0)]))),128))])]),s.path.poc_steps&&s.path.poc_steps.length?(o(),d("div",De,[c[9]||(c[9]=e("h4",null,[e("i",{class:"pi pi-code"}),$(" Proof of Concept Steps ")],-1)),e("div",Le,[(o(!0),d(A,null,T(s.path.poc_steps,r=>(o(),d("div",{key:r.step,class:"poc-step"},[e("div",ze,[e("span",Fe,"Step "+u(r.step),1),e("span",Me,u(r.name),1),r.requires_auth?(o(),d("span",Be,[...c[8]||(c[8]=[e("i",{class:"pi pi-lock"},null,-1),$(" Auth Required ",-1)])])):h("",!0)]),e("p",je,u(r.description),1),e("div",Oe,[e("code",null,u(r.command),1),w(g,{icon:"pi pi-copy",severity:"secondary",text:"",rounded:"",size:"small",onClick:C=>i(r.command)},null,8,["onClick"])]),r.mitre_technique?(o(),d("div",Ie," MITRE ATT&CK: "+u(r.mitre_technique),1)):h("",!0)]))),128))])])):h("",!0),s.path.mitre_tactics&&s.path.mitre_tactics.length?(o(),d("div",qe,[c[10]||(c[10]=e("h4",null,[e("i",{class:"pi pi-shield"}),$(" MITRE ATT&CK Tactics ")],-1)),e("div",Ne,[(o(!0),d(A,null,T(s.path.mitre_tactics,r=>(o(),d("span",{key:r,class:"mitre-tag"},u(l(r)),1))),128))])])):h("",!0),s.path.aws_services&&s.path.aws_services.length?(o(),d("div",Ue,[c[11]||(c[11]=e("h4",null,[e("i",{class:"pi pi-cloud"}),$(" Affected AWS Services ")],-1)),e("div",We,[(o(!0),d(A,null,T(s.path.aws_services,r=>(o(),d("span",{key:r,class:"service-tag"},u(r),1))),128))])])):h("",!0),s.path.finding_ids&&s.path.finding_ids.length?(o(),d("div",Ge,[c[12]||(c[12]=e("h4",null,[e("i",{class:"pi pi-list"}),$(" Related Findings ")],-1)),e("div",He,[(o(!0),d(A,null,T(s.path.finding_ids,r=>(o(),d("div",{key:r,class:"finding-link"},[w(S,{to:`/findings/${r}`},{default:N(()=>[$(" Finding #"+u(r),1)]),_:2},1032,["to"])]))),128))])])):h("",!0),e("div",Ke,[w(g,{label:"Export as Markdown",icon:"pi pi-file-edit",severity:"secondary",onClick:c[0]||(c[0]=r=>p.$emit("export",s.path))}),w(g,{label:"Copy All Commands",icon:"pi pi-copy",severity:"secondary",onClick:P})])])}}},Qe=O(Je,[["__scopeId","data-v-a604b5dc"]]),Xe={class:"attack-paths-view"},Ye={class:"page-header"},Ze={class:"header-actions"},et={key:0,class:"summary-cards"},tt={class:"card-value"},at={class:"card-value"},st={class:"card-value"},it={class:"card-value"},lt={class:"filters-section"},ot={class:"filter-group"},nt={class:"filter-group"},rt={class:"filter-group"},ct={class:"filter-group"},dt={key:1,class:"loading-state"},ut={key:2,class:"empty-state"},pt={key:3,class:"paths-list"},vt={key:4,class:"pagination"},mt={__name:"AttackPathsView",setup(s){const v=q(),n=X(),f=_(!1),k=_(null),l=J({minRiskScore:null,maxRiskScore:null,exploitability:null,entryPointType:null,targetType:null}),i=_(null),P=[{label:"Any",value:null,min:null,max:null},{label:"Critical (80-100)",value:"critical",min:80,max:null},{label:"High (60-79)",value:"high",min:60,max:80},{label:"Medium (40-59)",value:"medium",min:40,max:60},{label:"Low (<40)",value:"low",min:0,max:40}],p=[{label:"Any",value:null},{label:"Confirmed",value:"confirmed"},{label:"Likely",value:"likely"},{label:"Theoretical",value:"theoretical"}],c=[{label:"Any",value:null},{label:"Public S3",value:"public_s3"},{label:"Public Lambda",value:"public_lambda"},{label:"Public EC2",value:"public_ec2"},{label:"Public RDS",value:"public_rds"},{label:"Security Group",value:"public_security_group"},{label:"Exposed Credentials",value:"exposed_credentials"},{label:"Weak IAM Policy",value:"weak_iam_policy"}],g=[{label:"Any",value:null},{label:"Account Takeover",value:"account_takeover"},{label:"Data Exfiltration",value:"data_exfiltration"},{label:"Persistence",value:"persistence"},{label:"Privilege Escalation",value:"privilege_escalation"},{label:"Lateral Movement",value:"lateral_movement"}];Q(async()=>{await Promise.all([n.fetchPaths(),n.fetchSummary()])});const S=()=>{n.setFilters({minRiskScore:l.minRiskScore,maxRiskScore:l.maxRiskScore,exploitability:l.exploitability,entryPointType:l.entryPointType,targetType:l.targetType})},r=a=>{if(i.value===a)i.value=null,l.minRiskScore=null,l.maxRiskScore=null;else switch(i.value=a,a){case"critical":l.minRiskScore=80,l.maxRiskScore=null;break;case"high":l.minRiskScore=60,l.maxRiskScore=80;break;case"medium":l.minRiskScore=40,l.maxRiskScore=60;break;case"low":l.minRiskScore=0,l.maxRiskScore=40;break;default:l.minRiskScore=null,l.maxRiskScore=null}S()},C=a=>{const t=a.value;if(!t)l.minRiskScore=null,l.maxRiskScore=null,i.value=null;else{const m=P.find(E=>E.value===t);m&&(l.minRiskScore=m.min,l.maxRiskScore=m.max,i.value=t)}S()},F=()=>{Object.keys(l).forEach(a=>{l[a]=null}),i.value=null,n.clearFilters()},M=a=>{n.setPage(a.page+1)},L=async()=>{try{const a=await n.analyzePaths();v.add({severity:"success",summary:"Analysis Complete",detail:`Discovered ${a.paths_discovered} attack paths in ${a.analysis_time_ms}ms`,life:5e3})}catch(a){v.add({severity:"error",summary:"Analysis Failed",detail:a.message,life:5e3})}},B=async a=>{k.value=await n.fetchPath(a.id),f.value=!0},z=async a=>{try{const t=await n.exportPath(a.id,"markdown");await navigator.clipboard.writeText(t.content),v.add({severity:"success",summary:"Exported",detail:"Attack path copied to clipboard as Markdown",life:3e3})}catch(t){v.add({severity:"error",summary:"Export Failed",detail:t.message,life:3e3})}};return(a,t)=>{var I;const m=R("Button"),E=R("Dropdown"),U=R("ProgressSpinner"),W=R("Paginator"),G=R("Dialog");return o(),d("div",Xe,[e("div",Ye,[t[9]||(t[9]=e("div",{class:"header-content"},[e("h1",null,"Attack Paths"),e("p",{class:"subtitle"},"Discovered attack chains from entry points to targets")],-1)),e("div",Ze,[w(m,{label:"Analyze",icon:"pi pi-refresh",loading:y(n).loading,onClick:L,class:"analyze-btn"},null,8,["loading"])])]),y(n).summary?(o(),d("div",et,[e("div",{class:x(["summary-card critical clickable",{active:i.value==="critical"}]),onClick:t[0]||(t[0]=b=>r("critical"))},[e("div",tt,u(y(n).summary.critical_paths),1),t[10]||(t[10]=e("div",{class:"card-label"},"Critical Risk",-1)),t[11]||(t[11]=e("div",{class:"card-score"},"Score 80-100",-1))],2),e("div",{class:x(["summary-card high clickable",{active:i.value==="high"}]),onClick:t[1]||(t[1]=b=>r("high"))},[e("div",at,u(y(n).summary.high_risk_paths),1),t[12]||(t[12]=e("div",{class:"card-label"},"High Risk",-1)),t[13]||(t[13]=e("div",{class:"card-score"},"Score 60-79",-1))],2),e("div",{class:x(["summary-card medium clickable",{active:i.value==="medium"}]),onClick:t[2]||(t[2]=b=>r("medium"))},[e("div",st,u(y(n).summary.medium_risk_paths),1),t[14]||(t[14]=e("div",{class:"card-label"},"Medium Risk",-1)),t[15]||(t[15]=e("div",{class:"card-score"},"Score 40-59",-1))],2),e("div",{class:x(["summary-card low clickable",{active:i.value==="low"}]),onClick:t[3]||(t[3]=b=>r("low"))},[e("div",it,u(y(n).summary.low_risk_paths),1),t[16]||(t[16]=e("div",{class:"card-label"},"Low Risk",-1)),t[17]||(t[17]=e("div",{class:"card-score"},"Score 0-39",-1))],2)])):h("",!0),e("div",lt,[e("div",ot,[t[18]||(t[18]=e("label",null,"Risk Level",-1)),w(E,{modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=b=>i.value=b),options:P,optionLabel:"label",optionValue:"value",placeholder:"Any",class:"filter-dropdown",onChange:C},null,8,["modelValue"])]),e("div",nt,[t[19]||(t[19]=e("label",null,"Exploitability",-1)),w(E,{modelValue:l.exploitability,"onUpdate:modelValue":t[5]||(t[5]=b=>l.exploitability=b),options:p,optionLabel:"label",optionValue:"value",placeholder:"Any",class:"filter-dropdown",onChange:S},null,8,["modelValue"])]),e("div",rt,[t[20]||(t[20]=e("label",null,"Entry Point",-1)),w(E,{modelValue:l.entryPointType,"onUpdate:modelValue":t[6]||(t[6]=b=>l.entryPointType=b),options:c,optionLabel:"label",optionValue:"value",placeholder:"Any",class:"filter-dropdown",onChange:S},null,8,["modelValue"])]),e("div",ct,[t[21]||(t[21]=e("label",null,"Target",-1)),w(E,{modelValue:l.targetType,"onUpdate:modelValue":t[7]||(t[7]=b=>l.targetType=b),options:g,optionLabel:"label",optionValue:"value",placeholder:"Any",class:"filter-dropdown",onChange:S},null,8,["modelValue"])]),y(n).hasFilters?(o(),j(m,{key:0,label:"Clear",icon:"pi pi-times",severity:"secondary",text:"",onClick:F})):h("",!0)]),y(n).loading&&!y(n).paths.length?(o(),d("div",dt,[w(U),t[22]||(t[22]=e("p",null,"Loading attack paths...",-1))])):y(n).paths.length?(o(),d("div",pt,[(o(!0),d(A,null,T(y(n).paths,b=>(o(),j(he,{key:b.id,path:b,onView:B,onExport:z},null,8,["path"]))),128))])):(o(),d("div",ut,[t[23]||(t[23]=e("i",{class:"pi pi-shield empty-icon"},null,-1)),t[24]||(t[24]=e("h3",null,"No Attack Paths Discovered",-1)),t[25]||(t[25]=e("p",null,"Run the analyzer to discover attack paths from your security findings.",-1)),w(m,{label:"Run Analysis",icon:"pi pi-play",onClick:L})])),y(n).pagination.total>y(n).pagination.pageSize?(o(),d("div",vt,[w(W,{rows:y(n).pagination.pageSize,totalRecords:y(n).pagination.total,first:(y(n).pagination.page-1)*y(n).pagination.pageSize,onPage:M},null,8,["rows","totalRecords","first"])])):h("",!0),w(G,{visible:f.value,"onUpdate:visible":t[8]||(t[8]=b=>f.value=b),header:(I=k.value)==null?void 0:I.name,style:{width:"90vw",maxWidth:"1000px"},modal:"",dismissableMask:""},{default:N(()=>[k.value?(o(),j(Qe,{key:0,path:k.value,onExport:z},null,8,["path"])):h("",!0)]),_:1},8,["visible","header"])])}}},yt=O(mt,[["__scopeId","data-v-962542f8"]]);export{yt as default};
