import{_ as U,D as M,r as w,j as B,k as T,a as f,e,x as n,u as t,I as p,n as v,t as d,F as j,b as I,q as C,V as Q,A as u,J as W,Q as E,z as G,o as c,L as m,B as _,M as H,f as J,E as h,H as K,W as $,R as O,X as q}from"./index-D2tkqljB.js";import{u as X}from"./scans-De8fIZ3u.js";const Y={class:"scans-view"},Z={class:"page-header"},ss={class:"header-actions"},es={class:"section"},ts={class:"credential-cards"},ls={class:"provider-info"},as={class:"provider-status"},is={class:"provider-info"},ns={class:"provider-status"},os={class:"provider-info"},rs={class:"provider-status"},ds={class:"provider-info"},us={class:"provider-status"},cs={class:"credential-actions"},ps={class:"section"},vs={class:"profile-cards"},fs=["onClick"],ms={class:"profile-header"},gs={class:"profile-time"},ys={class:"profile-description"},Ss={class:"section"},bs={class:"section-header"},ws={key:0,class:"loading-container"},ks={key:1,class:"empty-state"},Cs={class:"scan-id"},_s={key:0},hs={key:1},$s={class:"new-scan-form"},Vs={class:"form-field"},Rs={class:"form-field"},zs={class:"form-field"},As={class:"form-field"},Ps={class:"form-field checkbox-field"},Ls={__name:"ScansView",setup(Ns){const V=G(),a=X(),R=M();a.setToast(R);const g=w(!1),b=w(null),o=w({profile:"comprehensive",target:"",severities:[],providers:["aws"],dryRun:!1}),z=[{label:"AWS",value:"aws"},{label:"Azure",value:"azure"},{label:"GCP",value:"gcp"},{label:"Kubernetes",value:"kubernetes"}],A=[{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"}];function y(i){return{"status-ready":i==="ready","status-partial":i==="partial","status-failed":i==="failed","status-unknown":i==="unknown"}}function S(i){return{ready:"Ready",partial:"Partial",failed:"Not Configured",unknown:"Unknown"}[i]||i}function P(i){return{running:"info",completed:"success",failed:"danger",cancelled:"warning",pending:"secondary"}[i]||"secondary"}function L(i){if(!i)return"-";const s=new Date(i),r=new Date-s;return r<6e4?"Just now":r<36e5?`${Math.floor(r/6e4)}m ago`:r<864e5?`${Math.floor(r/36e5)}h ago`:s.toLocaleDateString()}async function N(i){b.value=i;try{await a.createScan({profile:i})}catch(s){console.error("Failed to start scan:",s)}finally{b.value=null}}async function x(){try{await a.createScan({profile:o.value.profile,target:o.value.target||null,severityFilter:o.value.severities.length>0?o.value.severities.join(","):null,providers:o.value.providers.length>0?o.value.providers.join(","):null,dryRun:o.value.dryRun}),g.value=!1,o.value={profile:"comprehensive",target:"",severities:[],providers:["aws"],dryRun:!1}}catch(i){console.error("Failed to start scan:",i)}}async function D(i){try{await a.cancelScan(i)}catch(s){console.error("Failed to cancel scan:",s)}}function k({data:i}){i!=null&&i.scan_id&&V.push(`/scans/${i.scan_id}`)}function F(){a.pagination.page=1,a.fetchScans()}return B(async()=>{await Promise.all([a.fetchScans(),a.fetchProfiles(),a.fetchCredentialStatus()]);for(const i of a.runningScans)a.startPolling(i.scan_id)}),T(()=>{a.stopAllPolling()}),(i,s)=>(c(),f("div",Y,[e("div",Z,[s[13]||(s[13]=e("div",{class:"header-content"},[e("h1",null,"Scans"),e("p",{class:"subtitle"},"Launch security scans and monitor execution status")],-1)),e("div",ss,[n(t(p),{label:"New Scan",icon:"pi pi-plus",onClick:s[0]||(s[0]=l=>g.value=!0),disabled:t(a).hasRunningScans},null,8,["disabled"])])]),e("section",es,[s[22]||(s[22]=e("h2",{class:"section-title"},"Credential Status",-1)),e("div",ts,[e("div",{class:v(["credential-card",y(t(a).awsStatus)]),onClick:s[1]||(s[1]=l=>i.$router.push("/credentials"))},[s[15]||(s[15]=e("div",{class:"provider-icon"},[e("i",{class:"pi pi-cloud"})],-1)),e("div",ls,[s[14]||(s[14]=e("span",{class:"provider-name"},"AWS",-1)),e("span",as,d(S(t(a).awsStatus)),1)]),e("div",{class:v(["status-indicator",t(a).awsStatus])},null,2)],2),e("div",{class:v(["credential-card",y(t(a).azureStatus)]),onClick:s[2]||(s[2]=l=>i.$router.push("/credentials"))},[s[17]||(s[17]=e("div",{class:"provider-icon"},[e("i",{class:"pi pi-microsoft"})],-1)),e("div",is,[s[16]||(s[16]=e("span",{class:"provider-name"},"Azure",-1)),e("span",ns,d(S(t(a).azureStatus)),1)]),e("div",{class:v(["status-indicator",t(a).azureStatus])},null,2)],2),e("div",{class:v(["credential-card",y(t(a).gcpStatus)]),onClick:s[3]||(s[3]=l=>i.$router.push("/credentials"))},[s[19]||(s[19]=e("div",{class:"provider-icon"},[e("i",{class:"pi pi-google"})],-1)),e("div",os,[s[18]||(s[18]=e("span",{class:"provider-name"},"GCP",-1)),e("span",rs,d(S(t(a).gcpStatus)),1)]),e("div",{class:v(["status-indicator",t(a).gcpStatus])},null,2)],2),e("div",{class:v(["credential-card",y(t(a).kubernetesStatus)]),onClick:s[4]||(s[4]=l=>i.$router.push("/credentials"))},[s[21]||(s[21]=e("div",{class:"provider-icon"},[e("i",{class:"pi pi-server"})],-1)),e("div",ds,[s[20]||(s[20]=e("span",{class:"provider-name"},"Kubernetes",-1)),e("span",us,d(S(t(a).kubernetesStatus)),1)]),e("div",{class:v(["status-indicator",t(a).kubernetesStatus])},null,2)],2)]),e("div",cs,[n(t(p),{label:"Configure Credentials",icon:"pi pi-cog",severity:"secondary",size:"small",onClick:s[5]||(s[5]=l=>i.$router.push("/credentials"))})])]),e("section",ps,[s[23]||(s[23]=e("h2",{class:"section-title"},"Quick Actions",-1)),e("div",vs,[(c(!0),f(j,null,I(t(a).profiles,l=>(c(),f("div",{key:l.id,class:"profile-card",onClick:r=>N(l.id)},[e("div",ms,[e("h3",null,d(l.name),1),e("span",gs,d(l.estimatedTime),1)]),e("p",ys,d(l.description),1),n(t(p),{label:"Start",icon:"pi pi-play",size:"small",class:"profile-start-btn",loading:t(a).loading&&b.value===l.id,disabled:t(a).hasRunningScans},null,8,["loading","disabled"])],8,fs))),128))])]),e("section",Ss,[e("div",bs,[s[24]||(s[24]=e("h2",{class:"section-title"},"Recent Scans",-1)),n(t(p),{label:"View All",icon:"pi pi-list",text:"",size:"small",onClick:F})]),t(a).loading&&t(a).scans.length===0?(c(),f("div",ws,[n(t(Q)),s[25]||(s[25]=e("span",null,"Loading scans...",-1))])):t(a).scans.length===0?(c(),f("div",ks,[...s[26]||(s[26]=[e("i",{class:"pi pi-search"},null,-1),e("p",null,"No scans yet. Start a scan to begin security assessment.",-1)])])):(c(),C(t(W),{key:2,value:t(a).scans,responsiveLayout:"scroll",class:"p-datatable-sm",onRowClick:k},{default:u(()=>[n(t(m),{field:"scan_id",header:"ID"},{body:u(({data:l})=>{var r;return[e("span",Cs,d(((r=l.scan_id)==null?void 0:r.slice(0,8))||"-"),1)]}),_:1}),n(t(m),{field:"scan_type",header:"Profile"},{body:u(({data:l})=>[_(d(l.scan_type||l.tool||"N/A"),1)]),_:1}),n(t(m),{field:"status",header:"Status"},{body:u(({data:l})=>[n(t(H),{severity:P(l.status),value:l.status},null,8,["severity","value"])]),_:1}),n(t(m),{field:"total_findings",header:"Findings"},{body:u(({data:l})=>[l.status==="completed"?(c(),f("span",_s,d(l.total_findings||0),1)):(c(),f("span",hs,"-"))]),_:1}),n(t(m),{field:"started_at",header:"Started"},{body:u(({data:l})=>[_(d(L(l.started_at)),1)]),_:1}),n(t(m),{header:"Actions"},{body:u(({data:l})=>[l.status==="running"?(c(),C(t(p),{key:0,icon:"pi pi-stop",severity:"danger",text:"",size:"small",onClick:h(r=>D(l.scan_id),["stop"])},null,8,["onClick"])):J("",!0),n(t(p),{icon:"pi pi-eye",text:"",size:"small",onClick:h(r=>k({data:l}),["stop"])},null,8,["onClick"])]),_:1})]),_:1},8,["value"]))]),n(t(E),{visible:g.value,"onUpdate:visible":s[12]||(s[12]=l=>g.value=l),modal:"",header:"Start New Scan",style:{width:"500px"}},{footer:u(()=>[n(t(p),{label:"Cancel",text:"",onClick:s[11]||(s[11]=l=>g.value=!1)}),n(t(p),{label:"Start Scan",icon:"pi pi-play",onClick:x,loading:t(a).loading},null,8,["loading"])]),default:u(()=>[e("div",$s,[e("div",Vs,[s[27]||(s[27]=e("label",null,"Scan Profile",-1)),n(t(K),{modelValue:o.value.profile,"onUpdate:modelValue":s[6]||(s[6]=l=>o.value.profile=l),options:t(a).profiles,optionLabel:"name",optionValue:"id",placeholder:"Select a profile",class:"w-full"},null,8,["modelValue","options"])]),e("div",Rs,[s[28]||(s[28]=e("label",null,"Cloud Providers",-1)),n(t($),{modelValue:o.value.providers,"onUpdate:modelValue":s[7]||(s[7]=l=>o.value.providers=l),options:z,optionLabel:"label",optionValue:"value",placeholder:"Select providers to scan",class:"w-full",display:"chip"},null,8,["modelValue"])]),e("div",zs,[s[29]||(s[29]=e("label",null,"Target (optional)",-1)),n(t(O),{modelValue:o.value.target,"onUpdate:modelValue":s[8]||(s[8]=l=>o.value.target=l),placeholder:"e.g., specific account or resource",class:"w-full"},null,8,["modelValue"])]),e("div",As,[s[30]||(s[30]=e("label",null,"Severity Filter",-1)),n(t($),{modelValue:o.value.severities,"onUpdate:modelValue":s[9]||(s[9]=l=>o.value.severities=l),options:A,optionLabel:"label",optionValue:"value",placeholder:"All severities",class:"w-full"},null,8,["modelValue"])]),e("div",Ps,[n(t(q),{modelValue:o.value.dryRun,"onUpdate:modelValue":s[10]||(s[10]=l=>o.value.dryRun=l),binary:"",inputId:"dryRun"},null,8,["modelValue"]),s[31]||(s[31]=e("label",{for:"dryRun"},"Dry Run (preview commands without execution)",-1))])])]),_:1},8,["visible"])]))}},Fs=U(Ls,[["__scopeId","data-v-f35b05a4"]]);export{Fs as default};
