import{d as ie,r as f,c as b,Y as oe,Z as re,a as J,o as D,e as a,$ as M,_ as ue,D as de,j as ce,q as pe,x as r,u as o,I as h,V as ve,A as y,S as ge,Q as W,T as O,H as V,W as te,a1 as le,n as $,R as se,B as ne,t as fe}from"./index-D2tkqljB.js";const w="/api",me=ie("settings",()=>{const d=f([]),n=f({scans:{},data:{},notifications:{},display:{}}),p=f(!1),g=f(!1),v=f(null),c=f(null),S=b(()=>{var t;return((t=n.value.scans)==null?void 0:t.default_scan_profile)||"quick"}),k=b(()=>{var t;return((t=n.value.scans)==null?void 0:t.default_regions)||["us-east-1","us-west-2"]}),i=b(()=>{var t;return((t=n.value.scans)==null?void 0:t.default_severity_filter)||["critical","high"]}),_=b(()=>{var t;return((t=n.value.scans)==null?void 0:t.max_concurrent_scans)||3}),A=b(()=>{var t;return((t=n.value.data)==null?void 0:t.auto_cleanup_days)||90}),F=b(()=>{var t;return((t=n.value.data)==null?void 0:t.export_format)||"json"}),j=b(()=>{var t;return((t=n.value.notifications)==null?void 0:t.notifications_enabled)||!1}),P=b(()=>{var t;return((t=n.value.notifications)==null?void 0:t.webhook_url)||null}),U=b(()=>{var t;return((t=n.value.notifications)==null?void 0:t.email_alerts_enabled)||!1}),B=b(()=>{var t;return((t=n.value.display)==null?void 0:t.theme)||"dark"}),L=b(()=>{var t;return((t=n.value.display)==null?void 0:t.findings_per_page)||50});async function C(){p.value=!0,v.value=null;try{const t=await fetch(`${w}/settings`);if(!t.ok)throw new Error("Failed to fetch settings");const u=await t.json();d.value=u.settings;const s={scans:{},data:{},notifications:{},display:{}};for(const e of u.settings)s[e.category]&&(s[e.category][e.setting_key]=e.setting_value);return n.value=s,u.settings}catch(t){return v.value=t.message,console.error("Error fetching settings:",t),[]}finally{p.value=!1}}async function x(){p.value=!0,v.value=null;try{const t=await fetch(`${w}/settings/grouped`);if(!t.ok)throw new Error("Failed to fetch settings");const u=await t.json();return n.value=u,u}catch(t){return v.value=t.message,console.error("Error fetching grouped settings:",t),null}finally{p.value=!1}}async function T(t){try{const u=await fetch(`${w}/settings/${t}`);if(!u.ok)throw new Error(`Failed to fetch setting: ${t}`);return await u.json()}catch(u){return console.error(`Error fetching setting ${t}:`,u),null}}async function E(t,u){g.value=!0,v.value=null;try{const s=await fetch(`${w}/settings/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({value:u})});if(!s.ok){const m=await s.json().catch(()=>({}));throw new Error(m.detail||`Failed to update setting: ${t}`)}const e=await s.json(),l=d.value.findIndex(m=>m.setting_key===t);return l!==-1&&(d.value[l]=e),e.category&&n.value[e.category]&&(n.value[e.category][t]=u),c.value=new Date,e}catch(s){throw v.value=s.message,s}finally{g.value=!1}}async function N(t){g.value=!0,v.value=null;const u=[],s=[];try{for(const[e,l]of Object.entries(t))try{const m=await E(e,l);u.push(m)}catch(m){s.push({key:e,error:m.message})}return s.length>0&&(v.value=`Failed to update: ${s.map(e=>e.key).join(", ")}`),c.value=new Date,{results:u,errors:s}}finally{g.value=!1}}async function R(t=null){p.value=!0,v.value=null;try{const u=t?`?category=${t}`:"",s=await fetch(`${w}/settings/reset${u}`,{method:"POST"});if(!s.ok)throw new Error("Failed to reset settings");const e=await s.json();return await C(),e}catch(u){throw v.value=u.message,u}finally{p.value=!1}}async function I(t){try{const u=await fetch(`${w}/settings/category/${t}`);if(!u.ok)throw new Error(`Failed to fetch ${t} settings`);return(await u.json()).settings}catch(u){return console.error(`Error fetching ${t} settings:`,u),[]}}return{settings:d,settingsByCategory:n,loading:p,saving:g,error:v,lastSaved:c,defaultScanProfile:S,defaultRegions:k,defaultSeverityFilter:i,maxConcurrentScans:_,autoCleanupDays:A,exportFormat:F,notificationsEnabled:j,webhookUrl:P,emailAlertsEnabled:U,theme:B,findingsPerPage:L,fetchSettings:C,fetchSettingsGrouped:x,getSetting:T,updateSetting:E,updateMultipleSettings:N,resetSettings:R,fetchSettingsByCategory:I}});var be={root:{position:"relative"}},he={root:function(n){var p=n.instance,g=n.props;return["p-inputswitch p-component",{"p-highlight":p.checked,"p-disabled":g.disabled,"p-invalid":g.invalid}]},input:"p-inputswitch-input",slider:"p-inputswitch-slider"},ye=oe.extend({name:"inputswitch",classes:he,inlineStyles:be}),_e={name:"BaseInputSwitch",extends:re,props:{modelValue:{type:null,default:!1},trueValue:{type:null,default:!0},falseValue:{type:null,default:!1},invalid:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},tabindex:{type:Number,default:null},inputId:{type:String,default:null},inputClass:{type:[String,Object],default:null},inputStyle:{type:Object,default:null},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:ye,provide:function(){return{$parentInstance:this}}},q={name:"InputSwitch",extends:_e,inheritAttrs:!1,emits:["update:modelValue","change","focus","blur"],methods:{getPTOptions:function(n){var p=n==="root"?this.ptmi:this.ptm;return p(n,{context:{checked:this.checked,disabled:this.disabled}})},onChange:function(n){if(!this.disabled&&!this.readonly){var p=this.checked?this.falseValue:this.trueValue;this.$emit("update:modelValue",p),this.$emit("change",n)}},onFocus:function(n){this.$emit("focus",n)},onBlur:function(n){this.$emit("blur",n)}},computed:{checked:function(){return this.modelValue===this.trueValue}}},we=["data-p-highlight","data-p-disabled"],Se=["id","checked","tabindex","disabled","readonly","aria-checked","aria-labelledby","aria-label","aria-invalid"];function ke(d,n,p,g,v,c){return D(),J("div",M({class:d.cx("root"),style:d.sx("root")},c.getPTOptions("root"),{"data-p-highlight":c.checked,"data-p-disabled":d.disabled}),[a("input",M({id:d.inputId,type:"checkbox",role:"switch",class:[d.cx("input"),d.inputClass],style:d.inputStyle,checked:c.checked,tabindex:d.tabindex,disabled:d.disabled,readonly:d.readonly,"aria-checked":c.checked,"aria-labelledby":d.ariaLabelledby,"aria-label":d.ariaLabel,"aria-invalid":d.invalid||void 0,onFocus:n[0]||(n[0]=function(){return c.onFocus&&c.onFocus.apply(c,arguments)}),onBlur:n[1]||(n[1]=function(){return c.onBlur&&c.onBlur.apply(c,arguments)}),onChange:n[2]||(n[2]=function(){return c.onChange&&c.onChange.apply(c,arguments)})},c.getPTOptions("input")),null,16,Se),a("span",M({class:d.cx("slider")},c.getPTOptions("slider")),null,16)],16,we)}q.render=ke;const Ve={class:"settings-view"},Ce={class:"page-header"},xe={class:"header-actions"},Ee={key:0,class:"loading-container"},Oe={class:"settings-section"},$e={class:"setting-group"},De={class:"setting-item"},Ae={class:"setting-item"},Fe={class:"setting-item"},je={class:"settings-section"},Pe={class:"setting-group"},Ue={class:"setting-item"},Be={class:"setting-item"},Le={class:"settings-section"},Te={class:"setting-group"},Ne={class:"setting-item"},Re={class:"input-with-suffix"},Ie={class:"setting-item"},Me={class:"data-actions"},We={class:"action-buttons"},Je={class:"settings-section"},qe={class:"setting-group"},He={class:"setting-item"},Ye={class:"setting-item"},ze={class:"clear-old-info"},Ge={__name:"SettingsView",setup(d){const n=me(),p=de(),g=f(!1),v=f(!1),c=f(!1),S=f(!1),k=f(!1),i=f({default_scan_profile:"comprehensive",default_regions:["us-east-1","us-west-2"],max_concurrent_scans:3,auto_cleanup_days:90,export_format:"json",notifications_enabled:!1,webhook_url:null,webhook_events:["scan_complete","critical_finding"],email_alerts_enabled:!1,email_alert_address:null,email_alert_threshold:"critical",theme:"dark",findings_per_page:50}),_=f({}),A=[{label:"Quick Scan",value:"quick"},{label:"Comprehensive Scan",value:"comprehensive"},{label:"Compliance Only",value:"compliance-only"}],F=[{label:"US East (N. Virginia)",value:"us-east-1"},{label:"US East (Ohio)",value:"us-east-2"},{label:"US West (N. California)",value:"us-west-1"},{label:"US West (Oregon)",value:"us-west-2"},{label:"EU (Ireland)",value:"eu-west-1"},{label:"EU (Frankfurt)",value:"eu-central-1"},{label:"Asia Pacific (Tokyo)",value:"ap-northeast-1"},{label:"Asia Pacific (Singapore)",value:"ap-southeast-1"}],j=[{label:"Scan Complete",value:"scan_complete"},{label:"Scan Failed",value:"scan_failed"},{label:"Critical Finding",value:"critical_finding"},{label:"High Finding",value:"high_finding"}],P=[{label:"Critical",value:"critical"},{label:"High",value:"high"},{label:"Medium",value:"medium"},{label:"Low",value:"low"}],U=[{label:"JSON",value:"json"},{label:"CSV",value:"csv"},{label:"Markdown",value:"markdown"}],B=[{label:"Dark",value:"dark"},{label:"Light",value:"light"}],L=[{label:"25 per page",value:25},{label:"50 per page",value:50},{label:"100 per page",value:100}],C=b(()=>JSON.stringify(i.value)!==JSON.stringify(_.value));async function x(){var e,l,m,H,Y,z,G,Q,Z,K,X,ee,ae;await n.fetchSettingsGrouped();const s=n.settingsByCategory;i.value={default_scan_profile:((e=s.scans)==null?void 0:e.default_scan_profile)||"comprehensive",default_regions:((l=s.scans)==null?void 0:l.default_regions)||["us-east-1","us-west-2"],max_concurrent_scans:((m=s.scans)==null?void 0:m.max_concurrent_scans)||3,auto_cleanup_days:((H=s.data)==null?void 0:H.auto_cleanup_days)||90,export_format:((Y=s.data)==null?void 0:Y.export_format)||"json",notifications_enabled:((z=s.notifications)==null?void 0:z.notifications_enabled)||!1,webhook_url:((G=s.notifications)==null?void 0:G.webhook_url)||null,webhook_events:((Q=s.notifications)==null?void 0:Q.webhook_events)||["scan_complete","critical_finding"],email_alerts_enabled:((Z=s.notifications)==null?void 0:Z.email_alerts_enabled)||!1,email_alert_address:((K=s.notifications)==null?void 0:K.email_alert_address)||null,email_alert_threshold:((X=s.notifications)==null?void 0:X.email_alert_threshold)||"critical",theme:((ee=s.display)==null?void 0:ee.theme)||"dark",findings_per_page:((ae=s.display)==null?void 0:ae.findings_per_page)||50},_.value={...i.value}}async function T(){const s={};for(const[e,l]of Object.entries(i.value))JSON.stringify(l)!==JSON.stringify(_.value[e])&&(s[e]=l);if(Object.keys(s).length!==0)try{const e=await n.updateMultipleSettings(s);e.errors.length===0?(p.add({severity:"success",summary:"Settings Saved",detail:"Your settings have been updated successfully",life:3e3}),_.value={...i.value}):p.add({severity:"warn",summary:"Partial Save",detail:`Some settings could not be saved: ${e.errors.map(l=>l.key).join(", ")}`,life:5e3})}catch(e){p.add({severity:"error",summary:"Save Failed",detail:e.message,life:5e3})}}function E(){g.value=!0}async function N(){try{await n.resetSettings(),await x(),g.value=!1,p.add({severity:"success",summary:"Settings Reset",detail:"All settings have been reset to defaults",life:3e3})}catch(s){p.add({severity:"error",summary:"Reset Failed",detail:s.message,life:5e3})}}function R(){window.open("/api/exports/json?include_remediation=true","_blank")}function I(){c.value=!0}async function t(){k.value=!0;try{const s=i.value.auto_cleanup_days||90,e=await fetch(`/api/database/clear-old?days=${s}&confirm=true`,{method:"DELETE"});if(!e.ok){const m=await e.json();throw new Error(m.detail||"Failed to clear old scans")}const l=await e.json();p.add({severity:"success",summary:"Scans Cleared",detail:`Removed ${l.scans_deleted||0} scans older than ${s} days`,life:5e3}),c.value=!1}catch(s){p.add({severity:"error",summary:"Clear Failed",detail:s.message,life:5e3})}finally{k.value=!1}}async function u(){S.value=!0;try{const s=await fetch("/api/database/purge?confirm=true",{method:"DELETE"});if(!s.ok){const l=await s.json();throw new Error(l.detail||"Failed to purge database")}const e=await s.json();p.add({severity:"success",summary:"Database Purged",detail:`Removed ${e.total_rows_deleted} records from ${e.tables_purged.length} tables`,life:5e3}),v.value=!1}catch(s){p.add({severity:"error",summary:"Purge Failed",detail:s.message,life:5e3})}finally{S.value=!1}}return ce(()=>{x()}),(s,e)=>(D(),J("div",Ve,[a("div",Ce,[e[20]||(e[20]=a("div",{class:"header-content"},[a("h1",null,"Settings"),a("p",{class:"subtitle"},"Configure scan defaults, notifications, and data management")],-1)),a("div",xe,[r(o(h),{label:"Reset All",icon:"pi pi-refresh",severity:"secondary",onClick:E,disabled:o(n).loading},null,8,["disabled"]),r(o(h),{label:"Save Changes",icon:"pi pi-check",onClick:T,loading:o(n).saving,disabled:!C.value},null,8,["loading","disabled"])])]),o(n).loading?(D(),J("div",Ee,[r(o(ve)),e[21]||(e[21]=a("span",null,"Loading settings...",-1))])):(D(),pe(o(ge),{key:1,class:"settings-tabs"},{default:y(()=>[r(o(O),{header:"Scan Defaults"},{default:y(()=>[a("div",Oe,[a("div",$e,[a("div",De,[e[22]||(e[22]=a("div",{class:"setting-label"},[a("h4",null,"Default Scan Profile"),a("p",null,"Profile used when starting scans without explicit selection")],-1)),r(o(V),{modelValue:i.value.default_scan_profile,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value.default_scan_profile=l),options:A,optionLabel:"label",optionValue:"value",class:"setting-input"},null,8,["modelValue"])]),a("div",Ae,[e[23]||(e[23]=a("div",{class:"setting-label"},[a("h4",null,"Default Regions"),a("p",null,"AWS regions to scan by default")],-1)),r(o(te),{modelValue:i.value.default_regions,"onUpdate:modelValue":e[1]||(e[1]=l=>i.value.default_regions=l),options:F,optionLabel:"label",optionValue:"value",placeholder:"Select regions",class:"setting-input",maxSelectedLabels:3},null,8,["modelValue"])]),a("div",Fe,[e[24]||(e[24]=a("div",{class:"setting-label"},[a("h4",null,"Max Concurrent Scans"),a("p",null,"Maximum number of scans running simultaneously")],-1)),r(o(le),{modelValue:i.value.max_concurrent_scans,"onUpdate:modelValue":e[2]||(e[2]=l=>i.value.max_concurrent_scans=l),min:1,max:10,showButtons:"",class:"setting-input"},null,8,["modelValue"])])])])]),_:1}),r(o(O),{header:"Notifications"},{default:y(()=>[a("div",je,[a("div",Pe,[a("div",Ue,[e[25]||(e[25]=a("div",{class:"setting-label"},[a("h4",null,"Enable Notifications"),a("p",null,"Receive notifications for scan events")],-1)),r(o(q),{modelValue:i.value.notifications_enabled,"onUpdate:modelValue":e[3]||(e[3]=l=>i.value.notifications_enabled=l)},null,8,["modelValue"])]),a("div",{class:$(["setting-item",{disabled:!i.value.notifications_enabled}])},[e[26]||(e[26]=a("div",{class:"setting-label"},[a("h4",null,"Webhook URL"),a("p",null,"Webhook endpoint for notifications (Slack, Discord, etc.)")],-1)),r(o(se),{modelValue:i.value.webhook_url,"onUpdate:modelValue":e[4]||(e[4]=l=>i.value.webhook_url=l),placeholder:"https://...",class:"setting-input",disabled:!i.value.notifications_enabled},null,8,["modelValue","disabled"])],2),a("div",{class:$(["setting-item",{disabled:!i.value.notifications_enabled}])},[e[27]||(e[27]=a("div",{class:"setting-label"},[a("h4",null,"Webhook Events"),a("p",null,"Events that trigger webhook notifications")],-1)),r(o(te),{modelValue:i.value.webhook_events,"onUpdate:modelValue":e[5]||(e[5]=l=>i.value.webhook_events=l),options:j,optionLabel:"label",optionValue:"value",placeholder:"Select events",class:"setting-input",disabled:!i.value.notifications_enabled},null,8,["modelValue","disabled"])],2),a("div",Be,[e[28]||(e[28]=a("div",{class:"setting-label"},[a("h4",null,"Email Alerts"),a("p",null,"Enable email alerts for critical findings")],-1)),r(o(q),{modelValue:i.value.email_alerts_enabled,"onUpdate:modelValue":e[6]||(e[6]=l=>i.value.email_alerts_enabled=l)},null,8,["modelValue"])]),a("div",{class:$(["setting-item",{disabled:!i.value.email_alerts_enabled}])},[e[29]||(e[29]=a("div",{class:"setting-label"},[a("h4",null,"Alert Email Address"),a("p",null,"Email address for security alerts")],-1)),r(o(se),{modelValue:i.value.email_alert_address,"onUpdate:modelValue":e[7]||(e[7]=l=>i.value.email_alert_address=l),placeholder:"security@example.com",class:"setting-input",disabled:!i.value.email_alerts_enabled},null,8,["modelValue","disabled"])],2),a("div",{class:$(["setting-item",{disabled:!i.value.email_alerts_enabled}])},[e[30]||(e[30]=a("div",{class:"setting-label"},[a("h4",null,"Alert Threshold"),a("p",null,"Minimum severity for email alerts")],-1)),r(o(V),{modelValue:i.value.email_alert_threshold,"onUpdate:modelValue":e[8]||(e[8]=l=>i.value.email_alert_threshold=l),options:P,optionLabel:"label",optionValue:"value",class:"setting-input",disabled:!i.value.email_alerts_enabled},null,8,["modelValue","disabled"])],2)])])]),_:1}),r(o(O),{header:"Data Management"},{default:y(()=>[a("div",Le,[a("div",Te,[a("div",Ne,[e[32]||(e[32]=a("div",{class:"setting-label"},[a("h4",null,"Auto Cleanup"),a("p",null,"Automatically delete scan results older than specified days")],-1)),a("div",Re,[r(o(le),{modelValue:i.value.auto_cleanup_days,"onUpdate:modelValue":e[9]||(e[9]=l=>i.value.auto_cleanup_days=l),min:1,max:365,showButtons:""},null,8,["modelValue"]),e[31]||(e[31]=a("span",{class:"suffix"},"days",-1))])]),a("div",Ie,[e[33]||(e[33]=a("div",{class:"setting-label"},[a("h4",null,"Default Export Format"),a("p",null,"Default format for exporting findings")],-1)),r(o(V),{modelValue:i.value.export_format,"onUpdate:modelValue":e[10]||(e[10]=l=>i.value.export_format=l),options:U,optionLabel:"label",optionValue:"value",class:"setting-input"},null,8,["modelValue"])])]),a("div",Me,[e[34]||(e[34]=a("h4",null,"Data Operations",-1)),a("div",We,[r(o(h),{label:"Export All Data",icon:"pi pi-download",severity:"secondary",onClick:R}),r(o(h),{label:"Clear Old Scans",icon:"pi pi-trash",severity:"warning",onClick:I}),r(o(h),{label:"Purge All Data",icon:"pi pi-trash",severity:"danger",onClick:e[11]||(e[11]=l=>v.value=!0)})])])])]),_:1}),r(o(O),{header:"Display"},{default:y(()=>[a("div",Je,[a("div",qe,[a("div",He,[e[35]||(e[35]=a("div",{class:"setting-label"},[a("h4",null,"Theme"),a("p",null,"Application color theme")],-1)),r(o(V),{modelValue:i.value.theme,"onUpdate:modelValue":e[12]||(e[12]=l=>i.value.theme=l),options:B,optionLabel:"label",optionValue:"value",class:"setting-input"},null,8,["modelValue"])]),a("div",Ye,[e[36]||(e[36]=a("div",{class:"setting-label"},[a("h4",null,"Findings Per Page"),a("p",null,"Number of findings shown per page in lists")],-1)),r(o(V),{modelValue:i.value.findings_per_page,"onUpdate:modelValue":e[13]||(e[13]=l=>i.value.findings_per_page=l),options:L,optionLabel:"label",optionValue:"value",class:"setting-input"},null,8,["modelValue"])])])])]),_:1})]),_:1})),r(o(W),{visible:g.value,"onUpdate:visible":e[15]||(e[15]=l=>g.value=l),modal:"",header:"Reset Settings",style:{width:"400px"}},{footer:y(()=>[r(o(h),{label:"Cancel",text:"",onClick:e[14]||(e[14]=l=>g.value=!1)}),r(o(h),{label:"Reset",severity:"danger",onClick:N,loading:o(n).loading},null,8,["loading"])]),default:y(()=>[e[37]||(e[37]=a("p",null,"Are you sure you want to reset all settings to their default values?",-1))]),_:1},8,["visible"]),r(o(W),{visible:c.value,"onUpdate:visible":e[17]||(e[17]=l=>c.value=l),modal:"",header:"Clear Old Scans",style:{width:"450px"}},{footer:y(()=>[r(o(h),{label:"Cancel",text:"",onClick:e[16]||(e[16]=l=>c.value=!1)}),r(o(h),{label:"Clear Old Scans",severity:"warning",icon:"pi pi-trash",onClick:t,loading:k.value},null,8,["loading"])]),default:y(()=>[a("div",ze,[a("p",null,[e[38]||(e[38]=ne("This will delete scans and related data older than ",-1)),a("strong",null,fe(i.value.auto_cleanup_days)+" days",1),e[39]||(e[39]=ne(".",-1))]),e[40]||(e[40]=a("p",{class:"info-note"},"You can adjust the number of days in the Auto Cleanup setting above.",-1))])]),_:1},8,["visible"]),r(o(W),{visible:v.value,"onUpdate:visible":e[19]||(e[19]=l=>v.value=l),modal:"",header:"Purge Database",style:{width:"500px"}},{footer:y(()=>[r(o(h),{label:"Cancel",text:"",onClick:e[18]||(e[18]=l=>v.value=!1)}),r(o(h),{label:"Purge All Data",severity:"danger",icon:"pi pi-trash",onClick:u,loading:S.value},null,8,["loading"])]),default:y(()=>[e[41]||(e[41]=a("div",{class:"purge-warning"},[a("div",{class:"warning-header"},[a("i",{class:"pi pi-exclamation-triangle"}),a("span",null,"Warning: This action cannot be undone")]),a("p",null,"This will permanently delete ALL scan data including:"),a("ul",null,[a("li",null,"All scans and findings"),a("li",null,"Attack paths and privilege escalation paths"),a("li",null,"Public exposures and exposed credentials"),a("li",null,"IMDS checks and Lambda analysis"),a("li",null,"Severity overrides and tool execution history")]),a("p",null,"Credential verification status will also be reset.")],-1))]),_:1},8,["visible"])]))}},Ze=ue(Ge,[["__scopeId","data-v-43e1c4a2"]]);export{Ze as default};
