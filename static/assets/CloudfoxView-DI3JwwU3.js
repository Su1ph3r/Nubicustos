import{d as B,r as d,_ as I,c as S,j as T,k as U,a as _,e as a,f as x,x as r,q as F,u as o,I as R,n as A,t as h,H as M,A as j,J as D,K as O,o as c,L as y,M as J}from"./index-D2tkqljB.js";import{u as b}from"./executions-CLlZP_1s.js";const L="/api",q=B("cloudfox",()=>{const P=d([]),e=d(null),k=d(null),v=d(null),p=d(!1),g=d(null),f=d(null),m=d({page:1,pageSize:50,total:0}),i=d({moduleName:null,findingCategory:null,cloudProvider:null,riskLevel:null});async function C(){p.value=!0,g.value=null;try{const n=new URLSearchParams;n.append("page",m.value.page),n.append("page_size",m.value.pageSize),i.value.moduleName&&n.append("module_name",i.value.moduleName),i.value.findingCategory&&n.append("finding_category",i.value.findingCategory),i.value.cloudProvider&&n.append("cloud_provider",i.value.cloudProvider),i.value.riskLevel&&n.append("risk_level",i.value.riskLevel);const u=await fetch(`${L}/cloudfox?${n}`);if(!u.ok)throw new Error("Failed to fetch CloudFox results");const t=await u.json();P.value=t.results,m.value.total=t.total}catch(n){g.value=n.message,console.error("Error fetching CloudFox results:",n)}finally{p.value=!1}}async function w(){try{const n=await fetch(`${L}/cloudfox/summary`);if(!n.ok)throw new Error("Failed to fetch summary");return k.value=await n.json(),k.value}catch(n){return console.error("Error fetching summary:",n),null}}async function V(){try{const n=await fetch(`${L}/cloudfox/modules`);if(!n.ok)throw new Error("Failed to fetch modules");return v.value=await n.json(),v.value}catch(n){return console.error("Error fetching modules:",n),null}}async function N(n){p.value=!0,g.value=null;try{const u=await fetch(`${L}/cloudfox/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!u.ok)throw new Error("Failed to run CloudFox");const t=await u.json();return f.value=t,t.status==="running"&&t.execution_id&&b().startPolling(t.execution_id,l=>{f.value=l,l.status==="completed"&&(C(),w())}),t}catch(u){throw g.value=u.message,u}finally{p.value=!1}}async function E(){var n;(n=f.value)!=null&&n.execution_id&&(await b().stopExecution(f.value.execution_id),f.value=null)}async function $(){var n;return(n=f.value)!=null&&n.execution_id?await b().fetchExecutionLogs(f.value.execution_id):null}function z(n){i.value={...i.value,...n},m.value.page=1,C()}return{results:P,currentResult:e,summary:k,modules:v,loading:p,error:g,pagination:m,filters:i,currentExecution:f,fetchResults:C,fetchSummary:w,fetchModules:V,runCloudfox:N,stopCurrentExecution:E,getExecutionLogs:$,setFilters:z}}),G={class:"cloudfox-view"},H={class:"page-header"},K={class:"header-actions"},W={class:"execution-header"},Q={class:"execution-info"},X={class:"execution-title"},Y={class:"execution-meta"},Z={key:0,class:"execution-id"},ee={key:0,class:"execution-error"},te={key:1,class:"execution-logs"},oe={key:2,class:"execution-actions"},ne={key:1,class:"summary-cards"},se={class:"summary-card info"},le={class:"card-value"},ae={class:"filters-section"},ie={class:"arn-text"},ue={__name:"CloudfoxView",setup(P){const e=q(),k=b(),v=d({moduleName:null,riskLevel:null}),p=d(null),g=["all-checks","iam","buckets","secrets","lambda","env-vars","permissions"],f=["critical","high","medium","low"],m=S(()=>{var t;return((t=e.currentExecution)==null?void 0:t.status)==="running"}),i=S(()=>{var s;const t=(s=e.currentExecution)==null?void 0:s.status;return{"status-running":t==="running","status-completed":t==="completed","status-failed":t==="failed","status-pending":t==="pending"}}),C=S(()=>{var l;const t=(l=e.currentExecution)==null?void 0:l.status;return{running:"pi pi-spin pi-spinner",completed:"pi pi-check-circle",failed:"pi pi-times-circle",pending:"pi pi-clock"}[t]||"pi pi-info-circle"}),w=S(()=>{var l;const t=(l=e.currentExecution)==null?void 0:l.status;return{running:"CloudFox scan running...",completed:"CloudFox scan completed",failed:"CloudFox scan failed",pending:"CloudFox scan pending"}[t]||"CloudFox scan"});function V(t,s){return t?t.length>s?t.slice(0,s)+"...":t:""}function N(t){return{critical:"danger",high:"warning",medium:"info",low:"success"}[t]||"secondary"}function E(){e.setFilters(v.value)}async function $(){p.value=null,await e.runCloudfox({modules:["all"]})}async function z(){await e.stopCurrentExecution()}function n(){e.currentExecution=null,p.value=null}function u(t){e.pagination.page=t.page+1,e.fetchResults()}return T(()=>{e.fetchResults(),e.fetchSummary(),e.fetchModules()}),U(()=>{var t;(t=e.currentExecution)!=null&&t.execution_id&&k.stopPolling(e.currentExecution.execution_id)}),(t,s)=>(c(),_("div",G,[a("div",H,[s[3]||(s[3]=a("div",{class:"header-content"},[a("h1",null,"CloudFox"),a("p",{class:"subtitle"},"AWS/Azure/GCP enumeration results")],-1)),a("div",K,[m.value?(c(),F(o(R),{key:1,label:"Stop",icon:"pi pi-stop",severity:"danger",onClick:z})):(c(),F(o(R),{key:0,label:"Run CloudFox",icon:"pi pi-play",onClick:$,loading:o(e).loading},null,8,["loading"]))])]),o(e).currentExecution?(c(),_("div",{key:0,class:A(["execution-panel",i.value])},[a("div",W,[a("div",Q,[a("i",{class:A([C.value,"execution-icon"])},null,2),a("span",X,h(w.value),1)]),a("div",Y,[o(e).currentExecution.execution_id?(c(),_("span",Z," ID: "+h(o(e).currentExecution.execution_id),1)):x("",!0)])]),o(e).currentExecution.error?(c(),_("div",ee,h(o(e).currentExecution.error),1)):x("",!0),p.value?(c(),_("div",te,[a("pre",null,h(p.value),1)])):x("",!0),m.value?x("",!0):(c(),_("div",oe,[r(o(R),{label:"Dismiss",text:"",size:"small",onClick:n}),o(e).currentExecution.status==="completed"?(c(),F(o(R),{key:0,label:"View Results",size:"small",onClick:s[0]||(s[0]=l=>o(e).fetchResults())})):x("",!0)]))],2)):x("",!0),o(e).summary?(c(),_("div",ne,[a("div",se,[a("div",le,h(o(e).summary.total_results),1),s[4]||(s[4]=a("div",{class:"card-label"},"Total Results",-1))])])):x("",!0),a("div",ae,[r(o(M),{modelValue:v.value.moduleName,"onUpdate:modelValue":s[1]||(s[1]=l=>v.value.moduleName=l),options:g,placeholder:"Module",onChange:E,class:"filter-dropdown"},null,8,["modelValue"]),r(o(M),{modelValue:v.value.riskLevel,"onUpdate:modelValue":s[2]||(s[2]=l=>v.value.riskLevel=l),options:f,placeholder:"Risk Level",onChange:E,class:"filter-dropdown"},null,8,["modelValue"])]),r(o(D),{value:o(e).results,loading:o(e).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:j(()=>[r(o(y),{field:"module_name",header:"Module"}),r(o(y),{field:"resource_name",header:"Resource"}),r(o(y),{field:"resource_arn",header:"ARN"},{body:j(({data:l})=>[a("span",ie,h(V(l.resource_arn,50)),1)]),_:1}),r(o(y),{field:"finding_category",header:"Category"}),r(o(y),{field:"cloud_provider",header:"Provider"}),r(o(y),{field:"risk_level",header:"Risk"},{body:j(({data:l})=>[r(o(J),{severity:N(l.risk_level),value:l.risk_level},null,8,["severity","value"])]),_:1})]),_:1},8,["value","loading"]),o(e).pagination.total>o(e).pagination.pageSize?(c(),F(o(O),{key:2,rows:o(e).pagination.pageSize,totalRecords:o(e).pagination.total,first:(o(e).pagination.page-1)*o(e).pagination.pageSize,onPage:u},null,8,["rows","totalRecords","first"])):x("",!0)]))}},de=I(ue,[["__scopeId","data-v-133a1ca5"]]);export{de as default};
