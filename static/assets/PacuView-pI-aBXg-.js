import{d as te,r,c as N,N as H,_ as oe,j as le,k as ne,a as x,e as s,f as m,x as a,q as F,O as ae,P as ie,u as t,I as b,B,A as C,y as ue,n as J,t as c,Q as X,H as W,J as re,K as ce,o as _,R as de,M as G,L as V}from"./index-D2tkqljB.js";import{u as z}from"./executions-CLlZP_1s.js";const U="/api",_e=te("pacu",()=>{const A=r([]),o=r(null),$=r(null),M=r(null),w=r(!1),f=r(null),v=r(null),y=r({page:1,pageSize:50,total:0}),d=r({moduleName:null,moduleCategory:null,executionStatus:null,sessionName:null}),k=N(()=>A.value.filter(l=>l.execution_status==="success"));async function S(){w.value=!0,f.value=null;try{const l=new URLSearchParams;l.append("page",y.value.page),l.append("page_size",y.value.pageSize),d.value.moduleName&&l.append("module_name",d.value.moduleName),d.value.moduleCategory&&l.append("module_category",d.value.moduleCategory),d.value.executionStatus&&l.append("execution_status",d.value.executionStatus),d.value.sessionName&&l.append("session_name",d.value.sessionName);const h=await fetch(`${U}/pacu?${l}`);if(!h.ok)throw new Error("Failed to fetch Pacu results");const p=await h.json();A.value=p.results,y.value.total=p.total}catch(l){f.value=l.message,console.error("Error fetching Pacu results:",l)}finally{w.value=!1}}async function i(){try{const l=await fetch(`${U}/pacu/summary`);if(!l.ok)throw new Error("Failed to fetch summary");return $.value=await l.json(),$.value}catch(l){return console.error("Error fetching summary:",l),null}}async function P(){try{const l=await fetch(`${U}/pacu/modules`);if(!l.ok)throw new Error("Failed to fetch modules");return M.value=await l.json(),M.value}catch(l){return console.error("Error fetching modules:",l),null}}async function L(l){w.value=!0,f.value=null;try{const p=H().getSessionCredentials("aws"),R={...l};p&&(R.access_key=p.access_key_id,R.secret_key=p.secret_access_key,p.session_token&&(R.session_token=p.session_token),p.region&&(R.region=p.region));const D=await fetch(`${U}/pacu/run`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(R)});if(!D.ok)throw new Error("Failed to run Pacu module");const E=await D.json();return v.value=E,E.status==="running"&&E.execution_id&&z().startPolling(E.execution_id,I=>{v.value=I,I.status==="completed"&&(S(),i())}),E}catch(h){throw f.value=h.message,h}finally{w.value=!1}}async function T(){var l;(l=v.value)!=null&&l.execution_id&&(await z().stopExecution(v.value.execution_id),v.value=null)}async function j(){var l;return(l=v.value)!=null&&l.execution_id?await z().fetchExecutionLogs(v.value.execution_id):null}function O(l){d.value={...d.value,...l},y.value.page=1,S()}return{results:A,currentResult:o,summary:$,modules:M,loading:w,error:f,pagination:y,filters:d,currentExecution:v,successfulExecutions:k,fetchResults:S,fetchSummary:i,fetchModules:P,runModule:L,stopCurrentExecution:T,getExecutionLogs:j,setFilters:O}}),ve={class:"pacu-view"},pe={class:"page-header"},me={class:"header-actions"},fe={key:0,class:"no-credentials-warning"},ge={class:"execution-header"},xe={class:"execution-info"},ye={class:"execution-title"},he={class:"execution-meta"},we={key:0,class:"execution-id"},be={key:0,class:"execution-error"},ke={key:1,class:"execution-logs"},Se={key:2,class:"execution-actions"},Ee={class:"module-form"},Ce={class:"field"},Pe={class:"field"},Re={key:0,class:"result-details"},Ve={class:"detail-grid"},Ne={class:"detail-item"},$e={class:"value"},Me={class:"detail-item"},Le={class:"value"},De={class:"detail-item"},Ae={class:"value"},Ie={class:"detail-item"},Fe={class:"detail-item"},Ue={class:"value"},ze={class:"detail-item"},Te={class:"value"},je={class:"detail-item"},Oe={class:"value"},Be={class:"detail-item"},We={class:"value mono"},qe={key:0,class:"error-section"},Je={class:"error-content"},Xe={key:1,class:"logs-section"},Ge={class:"logs-content"},He={key:2,class:"summary-cards"},Ke={class:"summary-card info"},Qe={class:"card-value"},Ye={class:"summary-card success"},Ze={class:"card-value"},es={class:"summary-card danger"},ss={class:"card-value"},ts={class:"filters-section"},os={__name:"PacuView",setup(A){const o=_e(),$=z(),M=H(),w=N(()=>{const n=M.sessionCredentials.aws;return n&&n.access_key_id&&n.secret_access_key}),f=r({moduleCategory:null,executionStatus:null}),v=r(!1),y=r(null),d=r(""),k=r(null),S=r(!1),i=r(null),P=r(null),L=r(!1),T=["ENUM","PRIVESC","PERSIST","EXFIL","EXPLOIT","DETECTION"],j=["success","failed","running"],O=["iam__enum_permissions","iam__enum_users_roles_policies_groups","iam__bruteforce_permissions","ec2__enum","lambda__enum","rds__enum","ecs__enum","eks__enum","sns__enum","secrets__enum","dynamodb__enum","ebs__enum_volumes_snapshots","aws__enum_account","iam__privesc_scan","iam__backdoor_users_keys","iam__backdoor_users_password","iam__backdoor_assume_role","s3__download_bucket","ebs__download_snapshots","rds__explore_snapshots","detection__enum_services","cloudtrail__download_event_history","guardduty__list_findings"],l=N(()=>{var n;return((n=o.currentExecution)==null?void 0:n.status)==="running"}),h=N(()=>{var e;const n=(e=o.currentExecution)==null?void 0:e.status;return{"status-running":n==="running","status-completed":n==="completed","status-failed":n==="failed","status-pending":n==="pending"}}),p=N(()=>{var g;const n=(g=o.currentExecution)==null?void 0:g.status;return{running:"pi pi-spin pi-spinner",completed:"pi pi-check-circle",failed:"pi pi-times-circle",pending:"pi pi-clock"}[n]||"pi pi-info-circle"}),R=N(()=>{var g;const n=(g=o.currentExecution)==null?void 0:g.status;return{running:"Pacu module running...",completed:"Pacu module completed",failed:"Pacu module failed",pending:"Pacu module pending"}[n]||"Pacu module"});function D(n){return{success:"success",failed:"danger",running:"info"}[n]||"secondary"}function E(){o.setFilters(f.value)}function q(n){i.value=n,P.value=null,S.value=!0}async function I(){var n;if((n=i.value)!=null&&n.result_id){L.value=!0;try{const g=await(await fetch(`/api/executions/${i.value.result_id}/logs?tail=500`)).json();P.value=g.logs||"No logs available"}catch(e){P.value=`Error fetching logs: ${e.message}`}finally{L.value=!1}}}async function K(){var n;if((n=o.currentExecution)!=null&&n.execution_id)try{const g=await(await fetch(`/api/executions/${o.currentExecution.execution_id}/logs?tail=500`)).json();k.value=g.logs||"No logs available"}catch(e){k.value=`Error fetching logs: ${e.message}`}}async function Q(){v.value=!1,k.value=null,await o.runModule({module:y.value,session_name:d.value||"api-session"})}async function Y(){await o.stopCurrentExecution()}function Z(){o.currentExecution=null,k.value=null}function ee(n){o.pagination.page=n.page+1,o.fetchResults()}return le(()=>{o.fetchResults(),o.fetchSummary(),o.fetchModules()}),ne(()=>{var n;(n=o.currentExecution)!=null&&n.execution_id&&$.stopPolling(o.currentExecution.execution_id)}),(n,e)=>{const g=ue("router-link"),se=ie("tooltip");return _(),x("div",ve,[s("div",pe,[e[9]||(e[9]=s("div",{class:"header-content"},[s("h1",null,"Pacu"),s("p",{class:"subtitle"},"AWS exploitation framework results")],-1)),s("div",me,[l.value?(_(),F(t(b),{key:1,label:"Stop",icon:"pi pi-stop",severity:"danger",onClick:Y})):ae((_(),F(t(b),{key:0,label:"Run Module",icon:"pi pi-play",onClick:e[0]||(e[0]=u=>v.value=!0),loading:t(o).loading,disabled:!w.value},null,8,["loading","disabled"])),[[se,w.value?"":"Set up AWS credentials first",void 0,{left:!0}]])])]),w.value?m("",!0):(_(),x("div",fe,[e[13]||(e[13]=s("i",{class:"pi pi-info-circle"},null,-1)),s("span",null,[e[11]||(e[11]=B("AWS credentials required. Go to ",-1)),a(g,{to:"/credentials"},{default:C(()=>[...e[10]||(e[10]=[B("Credentials",-1)])]),_:1}),e[12]||(e[12]=B(', verify your credentials, and click "Use for Scans".',-1))])])),t(o).currentExecution?(_(),x("div",{key:1,class:J(["execution-panel",h.value])},[s("div",ge,[s("div",xe,[s("i",{class:J([p.value,"execution-icon"])},null,2),s("span",ye,c(R.value),1)]),s("div",he,[t(o).currentExecution.execution_id?(_(),x("span",we," ID: "+c(t(o).currentExecution.execution_id),1)):m("",!0)])]),t(o).currentExecution.error?(_(),x("div",be,c(t(o).currentExecution.error),1)):m("",!0),k.value?(_(),x("div",ke,[s("pre",null,c(k.value),1)])):m("",!0),l.value?m("",!0):(_(),x("div",Se,[a(t(b),{label:"Dismiss",text:"",size:"small",onClick:Z}),t(o).currentExecution.status==="completed"||t(o).currentExecution.status==="failed"?(_(),F(t(b),{key:0,label:"View Logs",size:"small",onClick:K})):m("",!0)]))],2)):m("",!0),a(t(X),{visible:v.value,"onUpdate:visible":e[4]||(e[4]=u=>v.value=u),header:"Run Pacu Module",style:{width:"450px"}},{footer:C(()=>[a(t(b),{label:"Cancel",text:"",onClick:e[3]||(e[3]=u=>v.value=!1)}),a(t(b),{label:"Run",icon:"pi pi-play",onClick:Q,disabled:!y.value},null,8,["disabled"])]),default:C(()=>[s("div",Ee,[s("div",Ce,[e[14]||(e[14]=s("label",{for:"module"},"Module",-1)),a(t(W),{id:"module",modelValue:y.value,"onUpdate:modelValue":e[1]||(e[1]=u=>y.value=u),options:O,placeholder:"Select a module",class:"w-full"},null,8,["modelValue"])]),s("div",Pe,[e[15]||(e[15]=s("label",{for:"session"},"Session Name",-1)),a(t(de),{id:"session",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=u=>d.value=u),placeholder:"api-session",class:"w-full"},null,8,["modelValue"])])])]),_:1},8,["visible"]),a(t(X),{visible:S.value,"onUpdate:visible":e[6]||(e[6]=u=>S.value=u),header:"Execution Details",style:{width:"700px"}},{footer:C(()=>[a(t(b),{label:"View Logs",icon:"pi pi-file",onClick:I,loading:L.value},null,8,["loading"]),a(t(b),{label:"Close",onClick:e[5]||(e[5]=u=>S.value=!1)})]),default:C(()=>[i.value?(_(),x("div",Re,[s("div",Ve,[s("div",Ne,[e[16]||(e[16]=s("label",null,"Module",-1)),s("span",$e,c(i.value.module_name),1)]),s("div",Me,[e[17]||(e[17]=s("label",null,"Category",-1)),s("span",Le,c(i.value.module_category),1)]),s("div",De,[e[18]||(e[18]=s("label",null,"Session",-1)),s("span",Ae,c(i.value.session_name),1)]),s("div",Ie,[e[19]||(e[19]=s("label",null,"Status",-1)),a(t(G),{severity:D(i.value.execution_status),value:i.value.execution_status},null,8,["severity","value"])]),s("div",Fe,[e[20]||(e[20]=s("label",null,"Account ID",-1)),s("span",Ue,c(i.value.target_account_id||"N/A"),1)]),s("div",ze,[e[21]||(e[21]=s("label",null,"Resources Affected",-1)),s("span",Te,c(i.value.resources_affected),1)]),s("div",je,[e[22]||(e[22]=s("label",null,"Duration",-1)),s("span",Oe,c(i.value.execution_time_ms?(i.value.execution_time_ms/1e3).toFixed(2)+"s":"N/A"),1)]),s("div",Be,[e[23]||(e[23]=s("label",null,"Result ID",-1)),s("span",We,c(i.value.result_id),1)])]),i.value.error_message?(_(),x("div",qe,[e[24]||(e[24]=s("label",null,"Error Details",-1)),s("pre",Je,c(i.value.error_message),1)])):m("",!0),P.value?(_(),x("div",Xe,[e[25]||(e[25]=s("label",null,"Execution Logs",-1)),s("pre",Ge,c(P.value),1)])):m("",!0)])):m("",!0)]),_:1},8,["visible"]),t(o).summary?(_(),x("div",He,[s("div",Ke,[s("div",Qe,c(t(o).summary.total_executions),1),e[26]||(e[26]=s("div",{class:"card-label"},"Total Executions",-1))]),s("div",Ye,[s("div",Ze,c(t(o).summary.successful),1),e[27]||(e[27]=s("div",{class:"card-label"},"Successful",-1))]),s("div",es,[s("div",ss,c(t(o).summary.failed),1),e[28]||(e[28]=s("div",{class:"card-label"},"Failed",-1))])])):m("",!0),s("div",ts,[a(t(W),{modelValue:f.value.moduleCategory,"onUpdate:modelValue":e[7]||(e[7]=u=>f.value.moduleCategory=u),options:T,placeholder:"Category",onChange:E,class:"filter-dropdown"},null,8,["modelValue"]),a(t(W),{modelValue:f.value.executionStatus,"onUpdate:modelValue":e[8]||(e[8]=u=>f.value.executionStatus=u),options:j,placeholder:"Status",onChange:E,class:"filter-dropdown"},null,8,["modelValue"])]),a(t(re),{value:t(o).results,loading:t(o).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:C(()=>[a(t(V),{field:"module_name",header:"Module"}),a(t(V),{field:"module_category",header:"Category"}),a(t(V),{field:"session_name",header:"Session"}),a(t(V),{field:"execution_status",header:"Status"},{body:C(({data:u})=>[a(t(G),{severity:D(u.execution_status),value:u.execution_status},null,8,["severity","value"])]),_:1}),a(t(V),{field:"resources_affected",header:"Resources"}),a(t(V),{field:"execution_time_ms",header:"Duration (ms)"}),a(t(V),{header:"Actions"},{body:C(({data:u})=>[a(t(b),{icon:"pi pi-eye",text:"",onClick:ls=>q(u)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),t(o).pagination.total>t(o).pagination.pageSize?(_(),F(t(ce),{key:3,rows:t(o).pagination.pageSize,totalRecords:t(o).pagination.total,first:(t(o).pagination.page-1)*t(o).pagination.pageSize,onPage:ee},null,8,["rows","totalRecords","first"])):m("",!0)])}}},is=oe(os,[["__scopeId","data-v-1f0bbb4b"]]);export{is as default};
