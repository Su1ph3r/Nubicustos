import{d as x,r as p,c as A,_ as F,j as V,a as B,e as f,x as s,u as a,H as N,A as y,J as T,o as b,L as c,M as k,t as J,q as j,f as C,I as $}from"./index-D2tkqljB.js";const g="/api",L=x("severityOverrides",()=>{const u=p([]),n=p(null),o=p(!1),l=p(null),d=p({page:1,pageSize:50,total:0}),v=p({approvalStatus:null}),w=A(()=>u.value.filter(t=>t.approval_status==="pending"));async function h(){o.value=!0,l.value=null;try{const t=new URLSearchParams;t.append("page",d.value.page),t.append("page_size",d.value.pageSize),v.value.approvalStatus&&t.append("approval_status",v.value.approvalStatus);const e=await fetch(`${g}/severity-overrides?${t}`);if(!e.ok)throw new Error("Failed to fetch overrides");const i=await e.json();u.value=i.overrides,d.value.total=i.total}catch(t){l.value=t.message,console.error("Error fetching overrides:",t)}finally{o.value=!1}}async function _(t){o.value=!0,l.value=null;try{const e=await fetch(`${g}/severity-overrides`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const i=await e.json();throw new Error(i.detail||"Failed to create override")}return await h(),await e.json()}catch(e){throw l.value=e.message,e}finally{o.value=!1}}async function m(t,e,i,E){try{if(!(await fetch(`${g}/severity-overrides/${t}/approve`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({approved:e,approved_by:i,notes:E})})).ok)throw new Error("Failed to process approval");return await h(),!0}catch(O){throw l.value=O.message,O}}async function S(t){try{if(!(await fetch(`${g}/severity-overrides/${t}`,{method:"DELETE"})).ok)throw new Error("Failed to delete override");return u.value=u.value.filter(i=>i.id!==t),!0}catch(e){throw l.value=e.message,e}}async function r(t){try{const e=await fetch(`${g}/severity-overrides/by-finding/${t}`);if(e.status===404)return null;if(!e.ok)throw new Error("Failed to fetch override");return await e.json()}catch{return null}}return{overrides:u,currentOverride:n,loading:o,error:l,pagination:d,filters:v,pendingOverrides:w,fetchOverrides:h,createOverride:_,approveOverride:m,deleteOverride:S,getOverrideByFinding:r}}),P={class:"severity-overrides-view"},z={class:"filters-section"},D={__name:"SeverityOverridesView",setup(u){const n=L(),o=p({approvalStatus:null}),l=["pending","approved","rejected"];function d(r,t){return r?r.length>t?r.slice(0,t)+"...":r:""}function v(r){return{critical:"danger",high:"warning",medium:"info",low:"success",info:"secondary"}[r]||"secondary"}function w(r){return{pending:"warning",approved:"success",rejected:"danger"}[r]||"secondary"}function h(){n.filters.approvalStatus=o.value.approvalStatus,n.fetchOverrides()}async function _(r){await n.approveOverride(r,!0,"Admin",null)}async function m(r){await n.approveOverride(r,!1,"Admin",null)}async function S(r){await n.deleteOverride(r)}return V(()=>{n.fetchOverrides()}),(r,t)=>(b(),B("div",P,[t[1]||(t[1]=f("div",{class:"page-header"},[f("div",{class:"header-content"},[f("h1",null,"Severity Overrides"),f("p",{class:"subtitle"},"Custom severity adjustments for findings")])],-1)),f("div",z,[s(a(N),{modelValue:o.value.approvalStatus,"onUpdate:modelValue":t[0]||(t[0]=e=>o.value.approvalStatus=e),options:l,placeholder:"Approval Status",onChange:h,class:"filter-dropdown"},null,8,["modelValue"])]),s(a(T),{value:a(n).overrides,loading:a(n).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:y(()=>[s(a(c),{field:"finding_id",header:"Finding ID"}),s(a(c),{field:"original_severity",header:"Original"},{body:y(({data:e})=>[s(a(k),{severity:v(e.original_severity),value:e.original_severity},null,8,["severity","value"])]),_:1}),s(a(c),{field:"new_severity",header:"New"},{body:y(({data:e})=>[s(a(k),{severity:v(e.new_severity),value:e.new_severity},null,8,["severity","value"])]),_:1}),s(a(c),{field:"justification",header:"Justification"},{body:y(({data:e})=>[f("span",null,J(d(e.justification,60)),1)]),_:1}),s(a(c),{field:"approval_status",header:"Status"},{body:y(({data:e})=>[s(a(k),{severity:w(e.approval_status),value:e.approval_status},null,8,["severity","value"])]),_:1}),s(a(c),{field:"created_by",header:"Created By"}),s(a(c),{header:"Actions"},{body:y(({data:e})=>[e.approval_status==="pending"?(b(),j(a($),{key:0,icon:"pi pi-check",class:"p-button-success p-button-text",onClick:i=>_(e.id)},null,8,["onClick"])):C("",!0),e.approval_status==="pending"?(b(),j(a($),{key:1,icon:"pi pi-times",class:"p-button-danger p-button-text",onClick:i=>m(e.id)},null,8,["onClick"])):C("",!0),s(a($),{icon:"pi pi-trash",class:"p-button-text",onClick:i=>S(e.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"])]))}},M=F(D,[["__scopeId","data-v-9e6a246f"]]);export{M as default};
