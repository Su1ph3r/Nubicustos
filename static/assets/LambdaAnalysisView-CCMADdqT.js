import{d as J,r as v,c as S,N as M,_ as K,j as G,k as Q,a as _,e as i,f,x as r,q as x,u as n,I as k,n as q,t as m,H,A as L,J as X,K as Y,o as p,L as w,M as T}from"./index-D2tkqljB.js";import{u as R}from"./executions-CLlZP_1s.js";import{s as Z}from"./progressbar.esm-BF4X16V2.js";const h="/api",ee=J("lambdaAnalysis",()=>{const g=v([]),t=v(null),b=v(null),l=v(!1),o=v(null),u=v(null),d=v({page:1,pageSize:50,total:0}),c=v({region:null,runtime:null,riskLevel:null,analysisStatus:null,hasSecrets:null}),C=S(()=>g.value.filter(e=>e.risk_score>=50)),V=S(()=>g.value.filter(e=>e.secrets_found&&e.secrets_found.length>0));async function E(){l.value=!0,o.value=null;try{const e=new URLSearchParams;e.append("page",d.value.page),e.append("page_size",d.value.pageSize),c.value.region&&e.append("region",c.value.region),c.value.runtime&&e.append("runtime",c.value.runtime),c.value.riskLevel&&e.append("risk_level",c.value.riskLevel),c.value.analysisStatus&&e.append("analysis_status",c.value.analysisStatus),c.value.hasSecrets!==null&&e.append("has_secrets",c.value.hasSecrets);const s=await fetch(`${h}/lambda-analysis?${e}`);if(!s.ok)throw new Error("Failed to fetch Lambda analyses");const a=await s.json();g.value=a.analyses,d.value.total=a.total}catch(e){o.value=e.message,console.error("Error fetching Lambda analyses:",e)}finally{l.value=!1}}async function F(e=50){l.value=!0,o.value=null;try{const s=new URLSearchParams;s.append("page",d.value.page),s.append("page_size",d.value.pageSize),s.append("min_risk_score",e);const a=await fetch(`${h}/lambda-analysis/risky?${s}`);if(!a.ok)throw new Error("Failed to fetch risky functions");const y=await a.json();g.value=y.analyses,d.value.total=y.total}catch(s){o.value=s.message}finally{l.value=!1}}async function j(){l.value=!0,o.value=null;try{const e=new URLSearchParams;e.append("page",d.value.page),e.append("page_size",d.value.pageSize);const s=await fetch(`${h}/lambda-analysis/with-secrets?${e}`);if(!s.ok)throw new Error("Failed to fetch functions with secrets");const a=await s.json();g.value=a.analyses,d.value.total=a.total}catch(e){o.value=e.message}finally{l.value=!1}}async function $(e){l.value=!0,o.value=null;try{const s=await fetch(`${h}/lambda-analysis/${e}`);if(!s.ok)throw new Error("Failed to fetch analysis");return t.value=await s.json(),t.value}catch(s){return o.value=s.message,null}finally{l.value=!1}}async function P(e){try{const s=await fetch(`${h}/lambda-analysis/${e}/findings`);if(!s.ok)throw new Error("Failed to fetch findings");return await s.json()}catch(s){throw o.value=s.message,s}}async function z(){try{const e=await fetch(`${h}/lambda-analysis/summary`);if(!e.ok)throw new Error("Failed to fetch summary");return b.value=await e.json(),b.value}catch(e){return console.error("Error fetching summary:",e),null}}async function W(e,s="markdown"){try{const a=await fetch(`${h}/lambda-analysis/${e}/export?format=${s}`);if(!a.ok)throw new Error("Export failed");return await a.json()}catch(a){throw o.value=a.message,a}}async function I(e){l.value=!0,o.value=null;try{const a=M().getSessionCredentials("aws"),y={...e};a&&(y.access_key=a.access_key_id,y.secret_key=a.secret_access_key,a.session_token&&(y.session_token=a.session_token),a.region&&(y.region=a.region));const D=await fetch(`${h}/lambda-analysis/analyze`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(y)});if(!D.ok)throw new Error("Failed to run Lambda analysis");const A=await D.json();return u.value=A,A.status==="running"&&A.execution_id&&R().startPolling(A.execution_id,O=>{u.value=O,O.status==="completed"&&(E(),z())}),A}catch(s){throw o.value=s.message,s}finally{l.value=!1}}async function U(){var e;(e=u.value)!=null&&e.execution_id&&(await R().stopExecution(u.value.execution_id),u.value=null)}async function B(){var e;return(e=u.value)!=null&&e.execution_id?await R().fetchExecutionLogs(u.value.execution_id):null}function N(e){c.value={...c.value,...e},d.value.page=1,E()}return{analyses:g,currentAnalysis:t,summary:b,loading:l,error:o,pagination:d,filters:c,currentExecution:u,riskyFunctions:C,functionsWithSecrets:V,fetchAnalyses:E,fetchRisky:F,fetchWithSecrets:j,fetchAnalysis:$,fetchFindings:P,fetchSummary:z,exportAnalysis:W,runAnalysis:I,stopCurrentExecution:U,getExecutionLogs:B,setFilters:N}}),se={class:"lambda-analysis-view"},ae={class:"page-header"},te={class:"header-actions"},ne={class:"execution-header"},ie={class:"execution-info"},le={class:"execution-title"},oe={class:"execution-meta"},re={key:0,class:"execution-id"},ce={key:0,class:"execution-error"},ue={key:1,class:"execution-logs"},de={key:2,class:"execution-actions"},pe={key:1,class:"summary-cards"},ve={class:"summary-card info"},ye={class:"card-value"},fe={class:"summary-card critical"},me={class:"card-value"},he={class:"summary-card high"},ge={class:"card-value"},_e={class:"summary-card medium"},ke={class:"card-value"},we={class:"filters-section"},xe={class:"issue-badges"},Se={__name:"LambdaAnalysisView",setup(g){const t=ee(),b=R(),l=v(!1),o=v(null),u=v({runtime:null,riskLevel:null}),d=["python3.11","python3.10","python3.9","nodejs18.x","nodejs16.x","java17","go1.x"],c=["critical","high","medium","low"],C=S(()=>{var e;return((e=t.currentExecution)==null?void 0:e.status)==="running"}),V=S(()=>{var s;const e=(s=t.currentExecution)==null?void 0:s.status;return{"status-running":e==="running","status-completed":e==="completed","status-failed":e==="failed","status-pending":e==="pending"}}),E=S(()=>{var a;const e=(a=t.currentExecution)==null?void 0:a.status;return{running:"pi pi-spin pi-spinner",completed:"pi pi-check-circle",failed:"pi pi-times-circle",pending:"pi pi-clock"}[e]||"pi pi-info-circle"}),F=S(()=>{var a;const e=(a=t.currentExecution)==null?void 0:a.status;return{running:"Lambda analysis running...",completed:"Lambda analysis completed",failed:"Lambda analysis failed",pending:"Lambda analysis pending"}[e]||"Lambda analysis"});function j(e){return{critical:"danger",high:"warning",medium:"info",low:"success"}[e]||"secondary"}function $(){t.setFilters(u.value)}function P(){l.value=!l.value,l.value?t.fetchWithSecrets():t.fetchAnalyses()}async function z(e){const s=await t.fetchAnalysis(e);console.log("Analysis:",s)}async function W(e){const s=await t.exportAnalysis(e,"markdown");console.log("Export:",s.content)}async function I(){o.value=null,await t.runAnalysis({analyze_all:!0})}async function U(){await t.stopCurrentExecution()}function B(){t.currentExecution=null,o.value=null}function N(e){t.pagination.page=e.page+1,l.value?t.fetchWithSecrets():t.fetchAnalyses()}return G(()=>{t.fetchAnalyses(),t.fetchSummary()}),Q(()=>{var e;(e=t.currentExecution)!=null&&e.execution_id&&b.stopPolling(t.currentExecution.execution_id)}),(e,s)=>(p(),_("div",se,[i("div",ae,[s[3]||(s[3]=i("div",{class:"header-content"},[i("h1",null,"Lambda Code Analysis"),i("p",{class:"subtitle"},"Serverless function security analysis")],-1)),i("div",te,[C.value?(p(),x(n(k),{key:1,label:"Stop",icon:"pi pi-stop",severity:"danger",onClick:U})):(p(),x(n(k),{key:0,label:"Analyze All",icon:"pi pi-search",onClick:I,loading:n(t).loading},null,8,["loading"]))])]),n(t).currentExecution?(p(),_("div",{key:0,class:q(["execution-panel",V.value])},[i("div",ne,[i("div",ie,[i("i",{class:q([E.value,"execution-icon"])},null,2),i("span",le,m(F.value),1)]),i("div",oe,[n(t).currentExecution.execution_id?(p(),_("span",re," ID: "+m(n(t).currentExecution.execution_id),1)):f("",!0)])]),n(t).currentExecution.error?(p(),_("div",ce,m(n(t).currentExecution.error),1)):f("",!0),o.value?(p(),_("div",ue,[i("pre",null,m(o.value),1)])):f("",!0),C.value?f("",!0):(p(),_("div",de,[r(n(k),{label:"Dismiss",text:"",size:"small",onClick:B}),n(t).currentExecution.status==="completed"?(p(),x(n(k),{key:0,label:"View Results",size:"small",onClick:s[0]||(s[0]=a=>n(t).fetchAnalyses())})):f("",!0)]))],2)):f("",!0),n(t).summary?(p(),_("div",pe,[i("div",ve,[i("div",ye,m(n(t).summary.total_functions),1),s[4]||(s[4]=i("div",{class:"card-label"},"Total Functions",-1))]),i("div",fe,[i("div",me,m(n(t).summary.functions_with_secrets),1),s[5]||(s[5]=i("div",{class:"card-label"},"With Secrets",-1))]),i("div",he,[i("div",ge,m(n(t).summary.functions_with_vulns),1),s[6]||(s[6]=i("div",{class:"card-label"},"With Vulns",-1))]),i("div",_e,[i("div",ke,m(n(t).summary.high_risk),1),s[7]||(s[7]=i("div",{class:"card-label"},"High Risk",-1))])])):f("",!0),i("div",we,[r(n(H),{modelValue:u.value.runtime,"onUpdate:modelValue":s[1]||(s[1]=a=>u.value.runtime=a),options:d,placeholder:"Runtime",onChange:$,class:"filter-dropdown"},null,8,["modelValue"]),r(n(H),{modelValue:u.value.riskLevel,"onUpdate:modelValue":s[2]||(s[2]=a=>u.value.riskLevel=a),options:c,placeholder:"Risk Level",onChange:$,class:"filter-dropdown"},null,8,["modelValue"]),r(n(k),{label:l.value?"Show All":"Show With Secrets",icon:l.value?"pi pi-list":"pi pi-key",onClick:P},null,8,["label","icon"])]),r(n(X),{value:n(t).analyses,loading:n(t).loading,responsiveLayout:"scroll",class:"p-datatable-sm"},{default:L(()=>[r(n(w),{field:"function_name",header:"Function"}),r(n(w),{field:"runtime",header:"Runtime"}),r(n(w),{field:"region",header:"Region"}),r(n(w),{field:"risk_score",header:"Risk Score"},{body:L(({data:a})=>[r(n(Z),{value:a.risk_score,showValue:!0,class:"risk-bar"},null,8,["value"])]),_:1}),r(n(w),{field:"risk_level",header:"Risk"},{body:L(({data:a})=>[r(n(T),{severity:j(a.risk_level),value:a.risk_level},null,8,["severity","value"])]),_:1}),r(n(w),{header:"Issues"},{body:L(({data:a})=>[i("span",xe,[a.secrets_found&&a.secrets_found.length?(p(),x(n(T),{key:0,severity:"danger",value:"Secrets"})):f("",!0),a.vulnerable_dependencies&&a.vulnerable_dependencies.length?(p(),x(n(T),{key:1,severity:"warning",value:"Vulns"})):f("",!0)])]),_:1}),r(n(w),{header:"Actions"},{body:L(({data:a})=>[r(n(k),{icon:"pi pi-eye",text:"",onClick:y=>z(a.id)},null,8,["onClick"]),r(n(k),{icon:"pi pi-download",text:"",onClick:y=>W(a.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),n(t).pagination.total>n(t).pagination.pageSize?(p(),x(n(Y),{key:2,rows:n(t).pagination.pageSize,totalRecords:n(t).pagination.total,first:(n(t).pagination.page-1)*n(t).pagination.pageSize,onPage:N},null,8,["rows","totalRecords","first"])):f("",!0)]))}},Ce=K(Se,[["__scopeId","data-v-8caddba0"]]);export{Ce as default};
