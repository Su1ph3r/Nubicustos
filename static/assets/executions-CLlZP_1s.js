import{d as _,r as s,c as h}from"./index-D2tkqljB.js";const c="/api",z=_("executions",()=>{const n=s([]),v=s(null),p=s(!1),i=s(null),r=s({}),f=s({page:1,pageSize:50,total:0});async function w(e=null,t=null){p.value=!0,i.value=null;try{const o=new URLSearchParams;o.append("page",f.value.page),o.append("page_size",f.value.pageSize),e&&o.append("tool_name",e),t&&o.append("status",t);const u=await fetch(`${c}/executions?${o}`);if(!u.ok)throw new Error("Failed to fetch executions");const a=await u.json();return n.value=a.executions,f.value.total=a.total,a.executions}catch(o){return i.value=o.message,console.error("Error fetching executions:",o),[]}finally{p.value=!1}}async function d(e){try{const t=await fetch(`${c}/executions/${e}`);if(!t.ok)throw new Error("Failed to fetch execution");const o=await t.json();return v.value=o,o}catch(t){return console.error("Error fetching execution:",t),null}}async function E(e,t=100){try{const o=await fetch(`${c}/executions/${e}/logs?tail=${t}`);if(!o.ok)throw new Error("Failed to fetch logs");return await o.json()}catch(o){return console.error("Error fetching logs:",o),null}}async function x(e){try{const t=await fetch(`${c}/executions/${e}/stop`,{method:"POST"});if(!t.ok)throw new Error("Failed to stop execution");return l(e),await t.json()}catch(t){throw i.value=t.message,t}}async function m(e){try{if(!(await fetch(`${c}/executions/${e}`,{method:"DELETE"})).ok)throw new Error("Failed to delete execution");return l(e),n.value=n.value.filter(o=>o.execution_id!==e),!0}catch(t){throw i.value=t.message,t}}async function y(){try{const e=await fetch(`${c}/executions/docker/status`);if(!e.ok)throw new Error("Failed to check Docker status");return await e.json()}catch(e){return console.error("Error checking Docker status:",e),{docker_available:!1,message:e.message}}}function k(e,t,o=3e3){if(r.value[e])return;const u=async()=>{const a=await d(e);if(a){const g=n.value.findIndex(P=>P.execution_id===e);g!==-1&&(n.value[g]=a),t&&t(a),["completed","failed","cancelled"].includes(a.status)&&l(e)}};u(),r.value[e]=setInterval(u,o)}function l(e){r.value[e]&&(clearInterval(r.value[e]),delete r.value[e])}function $(){Object.keys(r.value).forEach(e=>{l(e)})}const S=h(()=>n.value.filter(e=>e.status==="running")),j=h(()=>n.value.filter(e=>e.status==="completed")),F=h(()=>n.value.filter(e=>e.status==="failed"));return{executions:n,currentExecution:v,loading:p,error:i,pagination:f,runningExecutions:S,completedExecutions:j,failedExecutions:F,fetchExecutions:w,fetchExecution:d,fetchExecutionLogs:E,stopExecution:x,deleteExecution:m,checkDockerStatus:y,startPolling:k,stopPolling:l,stopAllPolling:$}});export{z as u};
