import{d as U,r as a,c as F}from"./index-D2tkqljB.js";const b="/api";class p extends Error{constructor(t,n,o){super(t),this.status=n,this.data=o}}async function f(e,t={}){const n=`${b}${e}`,o={headers:{"Content-Type":"application/json",...t.headers},...t};try{const i=await fetch(n,o);if(!i.ok){const l=await i.json().catch(()=>({}));throw new p(l.detail||`HTTP error ${i.status}`,i.status,l)}const c=await i.text();return c?JSON.parse(c):null}catch(i){throw i instanceof p?i:new p(i.message,0,null)}}const w={async getFindings(e={}){const t=new URLSearchParams;e.page&&t.set("page",e.page),e.page_size&&t.set("page_size",e.page_size),e.severity&&t.set("severity",e.severity),e.status&&t.set("status",e.status),e.tool&&t.set("tool",e.tool),e.cloud_provider&&t.set("cloud_provider",e.cloud_provider),e.resource_type&&t.set("resource_type",e.resource_type),e.search&&t.set("search",e.search),e.sort_by&&t.set("sort_by",e.sort_by),e.sort_order&&t.set("sort_order",e.sort_order);const n=t.toString();return f(`/findings${n?`?${n}`:""}`)},async getFinding(e){return f(`/findings/${e}`)},async getSummary(){return f("/findings/summary")},async updateFinding(e,t){return f(`/findings/${e}`,{method:"PATCH",body:JSON.stringify(t)})},async getScans(e={}){const t=new URLSearchParams;e.page&&t.set("page",e.page),e.page_size&&t.set("page_size",e.page_size),e.status&&t.set("status",e.status),e.tool&&t.set("tool",e.tool);const n=t.toString();return f(`/scans${n?`?${n}`:""}`)},async getScan(e){return f(`/scans/${e}`)},getExportUrl(e,t={}){const n=new URLSearchParams;t.severity&&n.set("severity",t.severity),t.status&&n.set("status",t.status),t.tool&&n.set("tool",t.tool),t.include_remediation&&n.set("include_remediation","true");const o=n.toString();return`${b}/exports/${e}${o?`?${o}`:""}`},async getHealth(){return f("/health")},async getDetailedHealth(){return f("/health/detailed")}},M=U("findings",()=>{const e=a([]),t=a(null),n=a(0),o=a(1),i=a(50),c=a(!1),l=a(null),g=a("risk_score"),h=a("desc"),y=a({severity:null,status:null,tool:null,cloud_provider:null,resource_type:null,search:""}),v=a({severities:["critical","high","medium","low","info"],statuses:["open","closed","mitigated","accepted"],tools:[],cloudProviders:[],resourceTypes:[]}),S=a({total:0,critical:0,high:0,medium:0,low:0,info:0,by_tool:{},by_provider:{}}),P=F(()=>Object.values(y.value).some(s=>s!==null&&s!=="")),$=F(()=>Math.ceil(n.value/i.value));async function z(){c.value=!0,l.value=null;try{const s={page:o.value,page_size:i.value,sort_by:g.value,sort_order:h.value,...y.value};Object.keys(s).forEach(u=>{(s[u]===null||s[u]==="")&&delete s[u]});const r=await w.getFindings(s);e.value=r.findings||[],n.value=r.total||0,k(e.value)}catch(s){l.value=s.message,e.value=[],n.value=0}finally{c.value=!1}}async function O(s){c.value=!0,l.value=null;try{t.value=await w.getFinding(s)}catch(r){l.value=r.message,t.value=null}finally{c.value=!1}}async function x(s,r){var u;try{const d=await w.updateFinding(s,r),_=e.value.findIndex(H=>H.id===s);return _!==-1&&(e.value[_]={...e.value[_],...d}),((u=t.value)==null?void 0:u.id)===s&&(t.value={...t.value,...d}),d}catch(d){throw l.value=d.message,d}}async function j(){try{const s=await fetch("/api/findings/summary");if(!s.ok)throw new Error("Failed to fetch summary");const r=await s.json();return S.value=r,r.by_tool&&(v.value.tools=Object.keys(r.by_tool).sort()),r.by_provider&&(v.value.cloudProviders=Object.keys(r.by_provider).sort()),r}catch(s){return console.error("Failed to fetch summary:",s),null}}function k(s){const r=new Set;s.forEach(u=>{u.resource_type&&r.add(u.resource_type)}),r.size>0&&(v.value.resourceTypes=[...r].sort())}function E(s,r){y.value[s]=r,o.value=1}function T(){y.value={severity:null,status:null,tool:null,cloud_provider:null,resource_type:null,search:""},o.value=1}function m(s){o.value=s}function q(s){i.value=s,o.value=1}function A(s,r){const d={severity:"severity",risk_score:"risk_score",scan_date:"scan_date",title:"title",tool:"tool",resource_type:"resource_type",region:"region",status:"status"}[s]||"risk_score";g.value=d,h.value=r===1?"asc":"desc",o.value=1}return{findings:e,currentFinding:t,total:n,page:o,pageSize:i,loading:c,error:l,filters:y,filterOptions:v,summary:S,sortBy:g,sortOrder:h,hasFilters:P,totalPages:$,fetchFindings:z,fetchFinding:O,updateFinding:x,fetchSummary:j,setFilter:E,clearFilters:T,setPage:m,setPageSize:q,setSort:A}});export{w as a,M as u};
